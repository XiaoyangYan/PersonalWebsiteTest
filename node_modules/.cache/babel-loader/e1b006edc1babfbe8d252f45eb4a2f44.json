{"ast":null,"code":"var through = require('through2');\n\nvar shasum = require('shasum-object');\n\nmodule.exports = function (opts) {\n  if (!opts) opts = {};\n  var rows = [];\n  return through.obj(write, end);\n\n  function write(row, enc, next) {\n    rows.push(row);\n    next();\n  }\n\n  function end() {\n    var tr = this;\n    rows.sort(cmp);\n    sorter(rows, tr, opts);\n  }\n};\n\nfunction sorter(rows, tr, opts) {\n  var expose = opts.expose || {};\n\n  if (Array.isArray(expose)) {\n    expose = expose.reduce(function (acc, key) {\n      acc[key] = true;\n      return acc;\n    }, {});\n  }\n\n  var hashes = {},\n      deduped = {};\n  var sameDeps = depCmp();\n\n  if (opts.dedupe) {\n    rows.forEach(function (row) {\n      var h = shasum(row.source);\n      sameDeps.add(row, h);\n\n      if (hashes[h]) {\n        hashes[h].push(row);\n      } else {\n        hashes[h] = [row];\n      }\n    });\n    Object.keys(hashes).forEach(function (h) {\n      var rows = hashes[h];\n\n      while (rows.length > 1) {\n        var row = rows.pop();\n        row.dedupe = rows[0].id;\n        row.sameDeps = sameDeps.cmp(rows[0].deps, row.deps);\n        deduped[row.id] = rows[0].id;\n      }\n    });\n  }\n\n  if (opts.index) {\n    var index = {};\n    var offset = 0;\n    rows.forEach(function (row, ix) {\n      if (has(expose, row.id)) {\n        row.index = row.id;\n        offset++;\n\n        if (expose[row.id] !== true) {\n          index[expose[row.id]] = row.index;\n        }\n      } else {\n        row.index = ix + 1 - offset;\n      }\n\n      index[row.id] = row.index;\n    });\n    rows.forEach(function (row) {\n      row.indexDeps = {};\n      Object.keys(row.deps).forEach(function (key) {\n        var id = row.deps[key];\n        row.indexDeps[key] = index[id];\n      });\n\n      if (row.dedupe) {\n        row.dedupeIndex = index[row.dedupe];\n      }\n\n      tr.push(row);\n    });\n  } else {\n    rows.forEach(function (row) {\n      tr.push(row);\n    });\n  }\n\n  tr.push(null);\n}\n\nfunction cmp(a, b) {\n  return a.id + a.hash < b.id + b.hash ? -1 : 1;\n}\n\nfunction has(obj, key) {\n  return Object.prototype.hasOwnProperty.call(obj, key);\n}\n\nfunction depCmp() {\n  var deps = {},\n      hashes = {};\n  return {\n    add: add,\n    cmp: cmp\n  };\n\n  function add(row, hash) {\n    deps[row.id] = row.deps;\n    hashes[row.id] = hash;\n  }\n\n  function cmp(a, b, limit) {\n    if (!a && !b) return true;\n    if (!a || !b) return false;\n    var keys = Object.keys(a);\n    if (keys.length !== Object.keys(b).length) return false;\n\n    for (var i = 0; i < keys.length; i++) {\n      var k = keys[i],\n          ka = a[k],\n          kb = b[k];\n      var ha = hashes[ka];\n      var hb = hashes[kb];\n      var da = deps[ka];\n      var db = deps[kb];\n      if (ka === kb) continue;\n\n      if (ha !== hb || !limit && !cmp(da, db, 1)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n}","map":{"version":3,"sources":["/home/yanxiaoyang/react-project/PersonalWebsiteTest/node_modules/deps-sort/index.js"],"names":["through","require","shasum","module","exports","opts","rows","obj","write","end","row","enc","next","push","tr","sort","cmp","sorter","expose","Array","isArray","reduce","acc","key","hashes","deduped","sameDeps","depCmp","dedupe","forEach","h","source","add","Object","keys","length","pop","id","deps","index","offset","ix","has","indexDeps","dedupeIndex","a","b","hash","prototype","hasOwnProperty","call","limit","i","k","ka","kb","ha","hb","da","db"],"mappings":"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","sourcesContent":["var through = require('through2');\nvar shasum = require('shasum-object');\n\nmodule.exports = function (opts) {\n    if (!opts) opts = {};\n    var rows = [];\n    return through.obj(write, end);\n    \n    function write (row, enc, next) { rows.push(row); next() }\n    \n    function end () {\n        var tr = this;\n        rows.sort(cmp);\n        sorter(rows, tr, opts);\n    }\n};\n\nfunction sorter (rows, tr, opts) {\n    var expose = opts.expose || {};\n    if (Array.isArray(expose)) {\n        expose = expose.reduce(function (acc, key) {\n            acc[key] = true;\n            return acc;\n        }, {});\n    }\n    \n    var hashes = {}, deduped = {};\n    var sameDeps = depCmp();\n    \n    if (opts.dedupe) {\n        rows.forEach(function (row) {\n            var h = shasum(row.source);\n            sameDeps.add(row, h);\n            if (hashes[h]) {\n                hashes[h].push(row);\n            } else {\n                hashes[h] = [row];\n            }\n        });\n        Object.keys(hashes).forEach(function (h) {\n            var rows = hashes[h];\n            while (rows.length > 1) {\n                var row = rows.pop();\n                row.dedupe = rows[0].id;\n                row.sameDeps = sameDeps.cmp(rows[0].deps, row.deps);\n                deduped[row.id] = rows[0].id;\n            }\n        });\n    }\n    \n    if (opts.index) {\n        var index = {};\n        var offset = 0;\n        rows.forEach(function (row, ix) {\n            if (has(expose, row.id)) {\n                row.index = row.id;\n                offset ++;\n                if (expose[row.id] !== true) {\n                    index[expose[row.id]] = row.index;\n                }\n            }\n            else {\n                row.index = ix + 1 - offset;\n            }\n            index[row.id] = row.index;\n        });\n        rows.forEach(function (row) {\n            row.indexDeps = {};\n            Object.keys(row.deps).forEach(function (key) {\n                var id = row.deps[key];\n                row.indexDeps[key] = index[id];\n            });\n            if (row.dedupe) {\n                row.dedupeIndex = index[row.dedupe];\n            }\n            tr.push(row);\n        });\n    }\n    else {\n        rows.forEach(function (row) { tr.push(row) });\n    }\n    tr.push(null);\n}\n\nfunction cmp (a, b) {\n    return a.id + a.hash < b.id + b.hash ? -1 : 1;\n}\n\nfunction has (obj, key) {\n    return Object.prototype.hasOwnProperty.call(obj, key);\n}\n\nfunction depCmp () {\n    var deps = {}, hashes = {};\n    return { add: add, cmp: cmp }\n    \n    function add (row, hash) {\n        deps[row.id] = row.deps;\n        hashes[row.id] = hash;\n    }\n    function cmp (a, b, limit) {\n        if (!a && !b) return true;\n        if (!a || !b) return false;\n        \n        var keys = Object.keys(a);\n        if (keys.length !== Object.keys(b).length) return false;\n\n        for (var i = 0; i < keys.length; i++) {\n            var k = keys[i], ka = a[k], kb = b[k];\n            var ha = hashes[ka];\n            var hb = hashes[kb];\n            var da = deps[ka];\n            var db = deps[kb];\n\n            if (ka === kb) continue;\n            if (ha !== hb || (!limit && !cmp(da, db, 1))) {\n                return false;\n            }\n        }\n        return true;\n    }\n}\n"]},"metadata":{},"sourceType":"script"}