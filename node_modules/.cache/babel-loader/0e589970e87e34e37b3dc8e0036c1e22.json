{"ast":null,"code":"'use strict';\n\nvar emitterify = require('./emitterify'),\n    keys = require('./keys'),\n    key = require('./key'),\n    deep = key,\n    rsplit = /([^\\.\\[]*)/;\n\nmodule.exports = once;\n\nfunction once(nodes, enter, exit) {\n  var n = c.nodes = Array === nodes.constructor ? nodes : 'string' === typeof nodes ? document.querySelectorAll(nodes) : [nodes];\n  var p = n.length;\n\n  while (p-- > 0) if (!n[p].on) event(n[p], p);\n\n  c.node = function () {\n    return n[0];\n  };\n\n  c.enter = function () {\n    return once(enter);\n  };\n\n  c.exit = function () {\n    return once(exit);\n  };\n\n  c.size = function () {\n    return n.length;\n  };\n\n  c.text = function (value) {\n    var fn = 'function' === typeof value;\n    return arguments.length === 0 ? n[0].textContent : (this.each(function (n, d, i) {\n      var r = '' + (fn ? value.call(this, d, i) : value),\n          t;\n      if (this.textContent !== r) !(t = this.firstChild) ? this.appendChild(document.createTextNode(r)) : t.nodeName === '#text' ? t.nodeValue = r : this.textContent = r;\n    }), this);\n  };\n\n  c.html = function (value) {\n    var fn = 'function' === typeof value;\n    return arguments.length === 0 ? n[0].innerHTML : (this.each(function (n, d, i) {\n      var r = '' + (fn ? value.call(this, d, i) : value),\n          t;\n      if (this.innerHTML !== r) this.innerHTML = r;\n    }), this);\n  };\n\n  c.attr = function (key, value) {\n    var fn = 'function' === typeof value;\n    return arguments.length === 1 ? n[0].getAttribute(key) : (this.each(function (n, d, i) {\n      var r = fn ? value.call(this, d, i) : value;\n      if (!r && this.hasAttribute(key)) this.removeAttribute(key);else if (r && this.getAttribute(key) !== r) this.setAttribute(key, r);\n    }), this);\n  };\n\n  c.classed = function (key, value) {\n    var fn = 'function' === typeof value;\n    return arguments.length === 1 ? n[0].classList.contains(key) : (this.each(function (n, d, i) {\n      var r = fn ? value.call(this, d, i) : value;\n      if (r && !this.classList.contains(key)) this.classList.add(key);else if (!r && this.classList.contains(key)) this.classList.remove(key);\n    }), this);\n  };\n\n  c.property = function (key, value) {\n    var fn = 'function' === typeof value;\n    return arguments.length === 1 ? deep(key)(n[0]) : (this.each(function (n, d, i) {\n      var r = fn ? value.call(this, d, i) : value;\n      if (r !== undefined && deep(key)(this) !== r) deep(key, function () {\n        return r;\n      })(this);\n    }), this);\n  };\n\n  c.each = function (fn) {\n    p = -1;\n\n    while (n[++p]) fn.call(n[p], n[p], n[p].state, p);\n\n    return this;\n  };\n\n  c.remove = function () {\n    this.each(function () {\n      var el = this.host && this.host.nodeName ? this.host : this;\n      el.parentNode.removeChild(el);\n    });\n    return this;\n  };\n\n  c.closest = function (tag) {\n    return once(n.map(function (d) {\n      return d.closest(tag);\n    }).filter(Boolean));\n  };\n\n  c.draw = proxy('draw', c);\n  c.once = proxy('once', c);\n  c.emit = proxy('emit', c);\n  c.on = proxy('on', c);\n  return c;\n\n  function c(s, d, k, b) {\n    var selector,\n        data,\n        tnodes = [],\n        tenter = [],\n        texit = [],\n        j = -1,\n        p = -1,\n        l = -1,\n        t = -1; // reselect\n\n    if (arguments.length === 1) {\n      if ('string' !== typeof s) return once(s);\n\n      while (n[++p]) tnodes = tnodes.concat(Array.prototype.slice.call(n[p].querySelectorAll(s), 0));\n\n      return once(tnodes);\n    } // shortcut\n\n\n    if (d === 1 && arguments.length == 2) {\n      while (n[++p]) {\n        j = n[p].children.length;\n        selector = s.call ? s(n[p].state || 1, 0) : s;\n\n        while (n[p].children[--j]) {\n          if (n[p].children[j].matches(selector)) {\n            (tnodes[++t] = n[p].children[j]).state = n[p].state || 1;\n            break;\n          }\n        }\n\n        if (j < 0) n[p].appendChild(tnodes[++t] = tenter[tenter.length] = create(selector, [n[p].state || 1], 0));\n        if ('function' === typeof tnodes[t].draw) tnodes[t].draw();\n      }\n\n      return once(tnodes, tenter, texit);\n    } // main loop\n\n\n    while (n[++p]) {\n      selector = 'function' === typeof s ? s(n[p].state) : s;\n      data = 'function' === typeof d ? d(n[p].state) : d;\n      if (d === 1) data = n[p].state || [1];\n      if ('string' === typeof data) data = [data];\n      if (!data) data = [];\n      if (data.constructor !== Array) data = [data];\n\n      if (k) {\n        byKey(selector, data, k, b, n[p], tnodes, tenter, texit);\n        continue;\n      }\n\n      l = -1;\n      j = -1;\n\n      while (n[p].children[++j]) {\n        if (!n[p].children[j].matches(selector)) continue;\n\n        if (++l >= data.length) {\n          // exit\n          n[p].removeChild(texit[texit.length] = n[p].children[j]), --j;\n          continue;\n        }\n\n        (tnodes[++t] = n[p].children[j]).state = data[l]; // update\n\n        if ('function' === typeof n[p].children[j].draw) n[p].children[j].draw();\n      } // enter\n\n\n      if (typeof selector === 'string') {\n        n[p].templates = n[p].templates || {};\n        n[p].templates[selector] = n[p].templates[selector] || create(selector, [], 0);\n\n        while (++l < data.length) {\n          (b ? n[p].insertBefore(tnodes[++t] = tenter[tenter.length] = n[p].templates[selector].cloneNode(false), n[p].querySelector(b)) : n[p].appendChild(tnodes[++t] = tenter[tenter.length] = n[p].templates[selector].cloneNode(false))).state = data[l];\n          if ('function' === typeof tnodes[t].draw) tnodes[t].draw();\n        }\n      } else {\n        while (++l < data.length) {\n          b ? n[p].insertBefore(tnodes[++t] = tenter[tenter.length] = create(selector, data, l), n[p].querySelector(b)) : n[p].appendChild(tnodes[++t] = tenter[tenter.length] = create(selector, data, l));\n          if ('function' === typeof tnodes[t].draw) tnodes[t].draw();\n        }\n      }\n    }\n\n    return once(tnodes, tenter, texit);\n  }\n} // TODO: factor out - need to fix nbuild / non-./deps\n\n\nfunction event(node) {\n  // node = node.host && node.host.nodeName ? node.host : node\n  if (node.on) return;\n  node.listeners = {};\n\n  const on = o => {\n    const type = o.type.split('.').shift();\n    if (!node.listeners[type]) node.addEventListener(type, node.listeners[type] = event => !event.detail || !event.detail.emitted ? emit(type, [event, node.state, node]) : 0);\n  };\n\n  const off = o => {\n    if (!node.on[o.type].length) {\n      node.removeEventListener(o.type, node.listeners[o.type]);\n      delete node.listeners[o.type];\n    }\n  };\n\n  emitterify(node, {\n    on,\n    off\n  });\n  const emit = node.emit;\n\n  node.emit = function (type, params) {\n    const detail = {\n      params,\n      emitted: true\n    },\n          event = new CustomEvent(type, {\n      detail,\n      bubbles: false,\n      cancelable: true\n    });\n    node.dispatchEvent(event);\n    return emit(type, event);\n  };\n}\n\nfunction proxy(fn, c) {\n  return function () {\n    var args = arguments;\n    c.each(function () {\n      var node = this.host && this.host.nodeName ? this.host : this;\n      node[fn] && node[fn].apply(node, args);\n    });\n    return c;\n  };\n}\n\nfunction create(s, d, j) {\n  var i = 0,\n      attrs = [],\n      css = [],\n      sel = s.call ? s(d[j], j) : s,\n      tag = rsplit.exec(sel)[1] || 'div',\n      node = document.createElement(tag);\n  (s.call ? s.toString() : s).replace(/\\[(.+?)=\"(.*?)\"\\]/g, function ($1, $2, $3) {\n    return attrs[attrs.length] = [$2, $3], '';\n  }).replace(/\\.([^.]+)/g, function ($1, $2) {\n    return css[css.length] = $2, '';\n  });\n\n  for (i = 0; i < attrs.length; i++) node.setAttribute(attrs[i][0], attrs[i][1]);\n\n  for (i = 0; i < css.length; i++) node.classList.add(css[i]);\n\n  node.state = d[j] || 1;\n  return node;\n}\n\nfunction byKey(selector, data, key, b, parent, tnodes, tenter, texit) {\n  var c = -1,\n      d = data.length,\n      k,\n      indexNodes = {},\n      child,\n      next;\n\n  while (parent.children[++c]) if (!parent.children[c].matches(selector)) continue;else indexNodes[key(parent.children[c].state)] = parent.children[c];\n\n  next = b ? parent.querySelector(b) : null;\n\n  while (d--) {\n    if (child = indexNodes[k = key(data[d])]) {\n      if (child === true) continue;else child.state = data[d];\n    } else tenter.unshift(child = create(selector, data, d));\n    indexNodes[k] = true;\n    if (d == data.length - 1 || next !== child.nextSibling) parent.insertBefore(child, next);\n    tnodes.unshift(next = child);\n    if ('function' === typeof child.draw) child.draw();\n  }\n\n  for (c in indexNodes) if (indexNodes[c] !== true) texit.unshift(parent.removeChild(indexNodes[c]));\n}","map":{"version":3,"sources":["/home/yanxiaoyang/react-project/PersonalWebsiteTest/node_modules/utilise/once.js"],"names":["emitterify","require","keys","key","deep","rsplit","module","exports","once","nodes","enter","exit","n","c","Array","constructor","document","querySelectorAll","p","length","on","event","node","size","text","value","fn","arguments","textContent","each","d","i","r","call","t","firstChild","appendChild","createTextNode","nodeName","nodeValue","html","innerHTML","attr","getAttribute","hasAttribute","removeAttribute","setAttribute","classed","classList","contains","add","remove","property","undefined","state","el","host","parentNode","removeChild","closest","tag","map","filter","Boolean","draw","proxy","emit","s","k","b","selector","data","tnodes","tenter","texit","j","l","concat","prototype","slice","children","matches","create","byKey","templates","insertBefore","cloneNode","querySelector","listeners","o","type","split","shift","addEventListener","detail","emitted","off","removeEventListener","params","CustomEvent","bubbles","cancelable","dispatchEvent","args","apply","attrs","css","sel","exec","createElement","toString","replace","$1","$2","$3","parent","indexNodes","child","next","unshift","nextSibling"],"mappings":"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","sourcesContent":["'use strict'\r\n\r\nvar emitterify = require('./emitterify')  \r\n  , keys = require('./keys')\r\n  , key = require('./key')\r\n  , deep = key\r\n  , rsplit = /([^\\.\\[]*)/\r\n\r\nmodule.exports = once\r\n\r\nfunction once(nodes, enter, exit) {\r\n  var n = c.nodes = Array === nodes.constructor ? nodes\r\n        : 'string' === typeof nodes ? document.querySelectorAll(nodes)\r\n        : [nodes]\r\n\r\n  var p = n.length\r\n  while (p-- > 0) if (!n[p].on) event(n[p], p)\r\n\r\n  c.node  = function() { return n[0] }\r\n  c.enter = function() { return once(enter) }\r\n  c.exit  = function() { return once(exit) }\r\n  c.size  = function() { return n.length }\r\n\r\n  c.text  = function(value){ \r\n    var fn = 'function' === typeof value\r\n    return arguments.length === 0 ? n[0].textContent : (this.each(function(n, d, i){\r\n      var r = '' + (fn ? value.call(this, d, i) : value), t\r\n      if (this.textContent !== r) \r\n        !(t = this.firstChild) ? this.appendChild(document.createTextNode(r))\r\n        : t.nodeName === '#text' ? t.nodeValue = r\r\n        : this.textContent = r\r\n    }), this)\r\n  }\r\n  c.html = function(value){\r\n    var fn = 'function' === typeof value\r\n    return arguments.length === 0 ? n[0].innerHTML : (this.each(function(n, d, i){\r\n      var r = '' + (fn ? value.call(this, d, i) : value), t\r\n      if (this.innerHTML !== r) this.innerHTML = r\r\n    }), this)\r\n  }\r\n  c.attr = function(key, value){\r\n    var fn = 'function' === typeof value\r\n    return arguments.length === 1 ? n[0].getAttribute(key) : (this.each(function(n, d, i){\r\n      var r = fn ? value.call(this, d, i) : value\r\n           if (!r && this.hasAttribute(key)) this.removeAttribute(key)\r\n      else if ( r && this.getAttribute(key) !== r) this.setAttribute(key, r)\r\n    }), this) \r\n  }\r\n  c.classed = function(key, value){\r\n    var fn = 'function' === typeof value\r\n    return arguments.length === 1 ? n[0].classList.contains(key) : (this.each(function(n, d, i){\r\n      var r = fn ? value.call(this, d, i) : value\r\n           if ( r && !this.classList.contains(key)) this.classList.add(key)\r\n      else if (!r &&  this.classList.contains(key)) this.classList.remove(key)\r\n    }), this) \r\n  }\r\n  c.property = function(key, value){\r\n    var fn = 'function' === typeof value\r\n    return arguments.length === 1 ? deep(key)(n[0]) : (this.each(function(n, d, i){\r\n      var r = fn ? value.call(this, d, i) : value\r\n      if (r !== undefined && deep(key)(this) !== r) deep(key, function(){ return r })(this)\r\n    }), this) \r\n  }\r\n  c.each = function(fn){\r\n    p = -1; while(n[++p])\r\n      fn.call(n[p], n[p], n[p].state, p)\r\n    return this\r\n  }\r\n  c.remove = function(){\r\n    this.each(function(){\r\n      var el = this.host && this.host.nodeName ? this.host : this\r\n      el.parentNode.removeChild(el)\r\n    }) \r\n    return this\r\n  }  \r\n  c.closest = function(tag){ \r\n    return once(n\r\n      .map(function(d){ return d.closest(tag) })\r\n      .filter(Boolean))\r\n  }\r\n  c.draw = proxy('draw', c)\r\n  c.once = proxy('once', c)\r\n  c.emit = proxy('emit', c)\r\n  c.on   = proxy('on', c)\r\n\r\n  return c\r\n  \r\n  function c(s, d, k, b) {\r\n    var selector\r\n      , data\r\n      , tnodes = []\r\n      , tenter = []\r\n      , texit  = []\r\n      , j = -1\r\n      , p = -1\r\n      , l = -1\r\n      , t = -1\r\n\r\n    // reselect\r\n    if (arguments.length === 1) {\r\n      if ('string' !== typeof s) return once(s)\r\n\r\n      while (n[++p]) \r\n        tnodes = tnodes.concat(Array.prototype.slice.call(n[p].querySelectorAll(s), 0))\r\n\r\n      return once(tnodes)\r\n    }\r\n\r\n    // shortcut\r\n    if (d === 1 && arguments.length == 2) {\r\n      while (n[++p]) { \r\n        j = n[p].children.length\r\n        selector = s.call ? s(n[p].state || 1, 0) : s\r\n        while (n[p].children[--j])  {\r\n          if (n[p].children[j].matches(selector)) {\r\n            (tnodes[++t] = n[p].children[j]).state = n[p].state || 1\r\n            break\r\n          }\r\n        }\r\n\r\n        if (j < 0) n[p].appendChild(tnodes[++t] = tenter[tenter.length] = create(selector, [n[p].state || 1], 0))\r\n        if ('function' === typeof tnodes[t].draw) tnodes[t].draw()\r\n      }\r\n\r\n      return once(tnodes, tenter, texit)\r\n    }\r\n\r\n    // main loop\r\n    while (n[++p]) {\r\n      selector = 'function' === typeof s ? s(n[p].state) : s\r\n      data     = 'function' === typeof d ? d(n[p].state) : d\r\n      \r\n      if (d === 1)                    data = n[p].state || [1]\r\n      if ('string' === typeof data)   data = [data]\r\n      if (!data)                      data = []\r\n      if (data.constructor !== Array) data = [data]\r\n      \r\n      if (k) {\r\n        byKey(selector, data, k, b, n[p], tnodes, tenter, texit)\r\n        continue\r\n      }\r\n\r\n      l = -1\r\n      j = -1\r\n\r\n      while (n[p].children[++j]) { \r\n        if (!n[p].children[j].matches(selector)) continue\r\n        if (++l >= data.length) { // exit\r\n          n[p].removeChild(texit[texit.length] = n[p].children[j]), --j\r\n          continue \r\n        }\r\n\r\n        (tnodes[++t] = n[p].children[j]).state = data[l] // update\r\n        if ('function' === typeof n[p].children[j].draw) n[p].children[j].draw()\r\n      }\r\n\r\n      // enter\r\n      if (typeof selector === 'string') { \r\n        n[p].templates = n[p].templates || {}\r\n        n[p].templates[selector] = n[p].templates[selector] || create(selector, [], 0)\r\n        while (++l < data.length) { \r\n          (b ? n[p].insertBefore(tnodes[++t] = tenter[tenter.length] = n[p].templates[selector].cloneNode(false), n[p].querySelector(b)) \r\n             : n[p].appendChild( tnodes[++t] = tenter[tenter.length] = n[p].templates[selector].cloneNode(false)))\r\n             .state = data[l]\r\n          if ('function' === typeof tnodes[t].draw) tnodes[t].draw()\r\n        }\r\n      } else {\r\n        while (++l < data.length) { \r\n          (b ? n[p].insertBefore(tnodes[++t] = tenter[tenter.length] = create(selector, data, l), n[p].querySelector(b)) \r\n             : n[p].appendChild( tnodes[++t] = tenter[tenter.length] = create(selector, data, l)))\r\n          if ('function' === typeof tnodes[t].draw) tnodes[t].draw()\r\n        }\r\n      }\r\n    }\r\n  \r\n    return once(tnodes, tenter, texit)\r\n  }\r\n\r\n}\r\n\r\n// TODO: factor out - need to fix nbuild / non-./deps\r\nfunction event(node) {\r\n  // node = node.host && node.host.nodeName ? node.host : node\r\n  if (node.on) return\r\n  node.listeners = {}\r\n\r\n  const on = o => {\r\n    const type = o.type.split('.').shift()\r\n    if (!node.listeners[type])\r\n      node.addEventListener(type, node.listeners[type] = \r\n        event => (!event.detail || !event.detail.emitted ? emit(type, [event, node.state, node]) : 0)\r\n      )\r\n  }\r\n\r\n  const off = o => {\r\n    if (!node.on[o.type].length) {\r\n      node.removeEventListener(o.type, node.listeners[o.type])\r\n      delete node.listeners[o.type]\r\n    }\r\n  }\r\n\r\n  emitterify(node, { on, off })\r\n  const { emit } = node\r\n\r\n  node.emit = function(type, params){\r\n    const detail = { params, emitted: true }\r\n        , event = new CustomEvent(type, { detail, bubbles: false, cancelable: true })\r\n    node.dispatchEvent(event)\r\n    return emit(type, event)\r\n  }\r\n}\r\n\r\nfunction proxy(fn, c) {\r\n  return function(){\r\n    var args = arguments\r\n    c.each(function(){\r\n      var node = this.host && this.host.nodeName ? this.host : this\r\n      node[fn] && node[fn].apply(node, args)\r\n    }) \r\n    return c \r\n  }\r\n}\r\n\r\nfunction create(s, d, j) {\r\n  var i     = 0\r\n    , attrs = []\r\n    , css   = []\r\n    , sel   = s.call ? s(d[j], j) : s\r\n    , tag   = rsplit.exec(sel)[1] || 'div'\r\n    , node  = document.createElement(tag)\r\n\r\n  ;(s.call ? s.toString() : s)\r\n    .replace(/\\[(.+?)=\"(.*?)\"\\]/g, function($1, $2, $3){ return attrs[attrs.length] = [$2, $3], '' })\r\n    .replace(/\\.([^.]+)/g, function($1, $2){ return css[css.length] = $2, ''})\r\n\r\n  for (i = 0; i < attrs.length; i++) \r\n    node.setAttribute(attrs[i][0], attrs[i][1])\r\n\r\n  for (i = 0; i < css.length; i++) \r\n    node.classList.add(css[i])\r\n\r\n  node.state = d[j] || 1\r\n  return node\r\n}\r\n\r\nfunction byKey(selector, data, key, b, parent, tnodes, tenter, texit) {\r\n  var c = -1\r\n    , d = data.length\r\n    , k\r\n    , indexNodes = {}\r\n    , child\r\n    , next\r\n\r\n  while (parent.children[++c]) \r\n    if (!parent.children[c].matches(selector)) continue\r\n    else indexNodes[key(parent.children[c].state)] = parent.children[c]\r\n\r\n  next = b ? parent.querySelector(b) : null\r\n\r\n  while (d--) {\r\n    if (child = indexNodes[k = key(data[d])])\r\n      if (child === true) continue\r\n      else child.state = data[d]\r\n    else\r\n      tenter.unshift(child = create(selector, data, d))\r\n    \r\n    indexNodes[k] = true\r\n\r\n    if (d == data.length - 1 || next !== child.nextSibling)\r\n      parent.insertBefore(child, next)\r\n\r\n    tnodes.unshift(next = child)\r\n    if ('function' === typeof child.draw) child.draw()\r\n  }\r\n\r\n  for (c in indexNodes)\r\n    if (indexNodes[c] !== true)\r\n      texit.unshift(parent.removeChild(indexNodes[c]))\r\n}"]},"metadata":{},"sourceType":"script"}