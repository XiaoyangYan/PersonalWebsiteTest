{"ast":null,"code":"/**\r\n * JSON + Object references wrapper\r\n *\r\n * @author Hunter Loftis <hunter@skookum.com>\r\n * @license The MIT license.\r\n * @copyright Copyright (c) 2010 Skookum, skookum.com\r\n */\n;\n\n(function () {\n  var CONTAINER_TYPES = 'object array date function'.split(' ');\n  var REFERENCE_FLAG = '_CRYO_REF_';\n  var INFINITY_FLAG = '_CRYO_INFINITY_';\n  var FUNCTION_FLAG = '_CRYO_FUNCTION_';\n  var UNDEFINED_FLAG = '_CRYO_UNDEFINED_';\n  var DATE_FLAG = '_CRYO_DATE_';\n  var OBJECT_FLAG = '_CRYO_OBJECT_';\n  var ARRAY_FLAG = '_CRYO_ARRAY_';\n\n  function typeOf(item) {\n    if (typeof item === 'object') {\n      if (item === null) return 'null';\n      if (item && item.nodeType === 1) return 'dom';\n      if (item instanceof Array) return 'array';\n      if (item instanceof Date) return 'date';\n      return 'object';\n    }\n\n    return typeof item;\n  } // Same as and copied from _.defaults\n\n\n  function defaults(obj) {\n    var length = arguments.length;\n    if (length < 2 || obj == null) return obj;\n\n    for (var index = 1; index < length; index++) {\n      var source = arguments[index],\n          keys = Object.keys(source),\n          l = keys.length;\n\n      for (var i = 0; i < l; i++) {\n        var key = keys[i];\n        if (obj[key] === void 0) obj[key] = source[key];\n      }\n    }\n\n    return obj;\n  }\n\n  ;\n\n  function stringify(item, options) {\n    var references = []; // Backward compatibility with 0.0.6 that exepects `options` to be a callback.\n\n    options = typeof options === 'function' ? {\n      prepare: options\n    } : options;\n    options = defaults(options || {}, {\n      prepare: null,\n      isSerializable: function (item, key) {\n        return item.hasOwnProperty(key);\n      }\n    });\n    var root = cloneWithReferences(item, references, options);\n    return JSON.stringify({\n      root: root,\n      references: references\n    });\n  }\n\n  function cloneWithReferences(item, references, options, savedItems) {\n    // invoke callback before any operations related to serializing the item\n    if (options.prepare) {\n      options.prepare(item);\n    }\n\n    savedItems = savedItems || [];\n    var type = typeOf(item); // can this object contain its own properties?\n\n    if (CONTAINER_TYPES.indexOf(type) !== -1) {\n      var referenceIndex = savedItems.indexOf(item); // do we need to store a new reference to this object?\n\n      if (referenceIndex === -1) {\n        var clone = {};\n        referenceIndex = references.push({\n          contents: clone,\n          value: wrapConstructor(item)\n        }) - 1;\n        savedItems[referenceIndex] = item;\n\n        for (var key in item) {\n          if (options.isSerializable(item, key)) {\n            clone[key] = cloneWithReferences(item[key], references, options, savedItems);\n          }\n        }\n      } // return something like _CRYO_REF_22\n\n\n      return REFERENCE_FLAG + referenceIndex;\n    } // return a non-container object\n\n\n    return wrap(item);\n  }\n\n  function parse(string, options) {\n    var json = JSON.parse(string); // Backward compatibility with 0.0.6 that exepects `options` to be a callback.\n\n    options = typeof options === 'function' ? {\n      finalize: options\n    } : options;\n    options = defaults(options || {}, {\n      finalize: null\n    });\n    return rebuildFromReferences(json.root, json.references, options);\n  }\n\n  function rebuildFromReferences(item, references, options, restoredItems) {\n    restoredItems = restoredItems || [];\n\n    if (starts(item, REFERENCE_FLAG)) {\n      var referenceIndex = parseInt(item.slice(REFERENCE_FLAG.length), 10);\n\n      if (!restoredItems.hasOwnProperty(referenceIndex)) {\n        var ref = references[referenceIndex];\n        var container = unwrapConstructor(ref.value);\n        var contents = ref.contents;\n        restoredItems[referenceIndex] = container;\n\n        for (var key in contents) {\n          container[key] = rebuildFromReferences(contents[key], references, options, restoredItems);\n        }\n      } // invoke callback after all operations related to serializing the item\n\n\n      if (options.finalize) {\n        options.finalize(restoredItems[referenceIndex]);\n      }\n\n      return restoredItems[referenceIndex];\n    } // invoke callback after all operations related to serializing the item\n\n\n    if (options.finalize) {\n      options.finalize(item);\n    }\n\n    return unwrap(item);\n  }\n\n  function wrap(item) {\n    var type = typeOf(item);\n    if (type === 'undefined') return UNDEFINED_FLAG;\n    if (type === 'function') return FUNCTION_FLAG + item.toString();\n    if (type === 'date') return DATE_FLAG + item.getTime();\n    if (item === Infinity) return INFINITY_FLAG;\n    if (type === 'dom') return undefined;\n    return item;\n  }\n\n  function wrapConstructor(item) {\n    var type = typeOf(item);\n    if (type === 'function' || type === 'date') return wrap(item);\n    if (type === 'object') return OBJECT_FLAG;\n    if (type === 'array') return ARRAY_FLAG;\n    return item;\n  }\n\n  function unwrapConstructor(val) {\n    if (typeOf(val) === 'string') {\n      if (val === UNDEFINED_FLAG) return undefined;\n\n      if (starts(val, FUNCTION_FLAG)) {\n        return new Function(\"return \" + val.slice(FUNCTION_FLAG.length))();\n      }\n\n      if (starts(val, DATE_FLAG)) {\n        var dateNum = parseInt(val.slice(DATE_FLAG.length), 10);\n        return new Date(dateNum);\n      }\n\n      if (starts(val, OBJECT_FLAG)) {\n        return {};\n      }\n\n      if (starts(val, ARRAY_FLAG)) {\n        return [];\n      }\n\n      if (val === INFINITY_FLAG) return Infinity;\n    }\n\n    return val;\n  }\n\n  function unwrap(val) {\n    if (typeOf(val) === 'string') {\n      if (val === UNDEFINED_FLAG) return undefined;\n\n      if (starts(val, FUNCTION_FLAG)) {\n        var fn = val.slice(FUNCTION_FLAG.length);\n        var argStart = fn.indexOf('(') + 1;\n        var argEnd = fn.indexOf(')', argStart);\n        var args = fn.slice(argStart, argEnd);\n        var bodyStart = fn.indexOf('{') + 1;\n        var bodyEnd = fn.lastIndexOf('}') - 1;\n        var body = fn.slice(bodyStart, bodyEnd);\n        return new Function(args, body);\n      }\n\n      if (starts(val, DATE_FLAG)) {\n        var dateNum = parseInt(val.slice(DATE_FLAG.length), 10);\n        return new Date(dateNum);\n      }\n\n      if (val === INFINITY_FLAG) return Infinity;\n    }\n\n    return val;\n  }\n\n  function starts(string, prefix) {\n    return typeOf(string) === 'string' && string.slice(0, prefix.length) === prefix;\n  }\n\n  function isNumber(n) {\n    return !isNaN(parseFloat(n)) && isFinite(n);\n  } // Exported object\n\n\n  var Cryo = {\n    stringify: stringify,\n    parse: parse\n  }; // global on server, window in browser\n\n  var root = this; // AMD / RequireJS\n\n  if (typeof define !== 'undefined' && define.amd) {\n    define('Cryo', [], function () {\n      return Cryo;\n    });\n  } // node.js\n  else if (typeof module !== 'undefined' && module.exports) {\n      module.exports = Cryo;\n    } // included directly via <script> tag\n    else {\n        root.Cryo = Cryo;\n      }\n})();","map":{"version":3,"sources":["/home/yanxiaoyang/react-project/PersonalWebsiteTest/node_modules/cryonic/lib/cryo.js"],"names":["CONTAINER_TYPES","split","REFERENCE_FLAG","INFINITY_FLAG","FUNCTION_FLAG","UNDEFINED_FLAG","DATE_FLAG","OBJECT_FLAG","ARRAY_FLAG","typeOf","item","nodeType","Array","Date","defaults","obj","length","arguments","index","source","keys","Object","l","i","key","stringify","options","references","prepare","isSerializable","hasOwnProperty","root","cloneWithReferences","JSON","savedItems","type","indexOf","referenceIndex","clone","push","contents","value","wrapConstructor","wrap","parse","string","json","finalize","rebuildFromReferences","restoredItems","starts","parseInt","slice","ref","container","unwrapConstructor","unwrap","toString","getTime","Infinity","undefined","val","Function","dateNum","fn","argStart","argEnd","args","bodyStart","bodyEnd","lastIndexOf","body","prefix","isNumber","n","isNaN","parseFloat","isFinite","Cryo","define","amd","module","exports"],"mappings":"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","sourcesContent":["/**\r\n * JSON + Object references wrapper\r\n *\r\n * @author Hunter Loftis <hunter@skookum.com>\r\n * @license The MIT license.\r\n * @copyright Copyright (c) 2010 Skookum, skookum.com\r\n */\r\n\r\n;(function() {\r\n\r\n  var CONTAINER_TYPES = 'object array date function'.split(' ');\r\n\r\n  var REFERENCE_FLAG = '_CRYO_REF_';\r\n  var INFINITY_FLAG = '_CRYO_INFINITY_';\r\n  var FUNCTION_FLAG = '_CRYO_FUNCTION_';\r\n  var UNDEFINED_FLAG = '_CRYO_UNDEFINED_';\r\n  var DATE_FLAG = '_CRYO_DATE_';\r\n\r\n  var OBJECT_FLAG = '_CRYO_OBJECT_';\r\n  var ARRAY_FLAG = '_CRYO_ARRAY_';\r\n\r\n  function typeOf(item) {\r\n    if (typeof item === 'object') {\r\n      if (item === null) return 'null';\r\n      if (item && item.nodeType === 1) return 'dom';\r\n      if (item instanceof Array) return 'array';\r\n      if (item instanceof Date) return 'date';\r\n      return 'object';\r\n    }\r\n    return typeof item;\r\n  }\r\n\r\n  // Same as and copied from _.defaults\r\n  function defaults(obj) {\r\n    var length = arguments.length;\r\n    if (length < 2 || obj == null) return obj;\r\n    for (var index = 1; index < length; index++) {\r\n      var source = arguments[index],\r\n          keys = Object.keys(source),\r\n          l = keys.length;\r\n      for (var i = 0; i < l; i++) {\r\n        var key = keys[i];\r\n        if (obj[key] === void 0) obj[key] = source[key];\r\n      }\r\n    }\r\n    return obj;\r\n  };\r\n\r\n  function stringify(item, options) {\r\n    var references = [];\r\n\r\n    // Backward compatibility with 0.0.6 that exepects `options` to be a callback.\r\n    options = typeof options === 'function' ? { prepare: options } : options;\r\n    options = defaults(options || {}, {\r\n      prepare: null,\r\n      isSerializable: function(item, key) {\r\n        return item.hasOwnProperty(key);\r\n      }\r\n    });\r\n\r\n    var root = cloneWithReferences(item, references, options);\r\n\r\n    return JSON.stringify({\r\n      root: root,\r\n      references: references\r\n    });\r\n  }\r\n\r\n  function cloneWithReferences(item, references, options, savedItems) {\r\n    // invoke callback before any operations related to serializing the item\r\n    if (options.prepare) { options.prepare(item); }\r\n\r\n    savedItems = savedItems || [];\r\n    var type = typeOf(item);\r\n\r\n    // can this object contain its own properties?\r\n    if (CONTAINER_TYPES.indexOf(type) !== -1) {\r\n      var referenceIndex = savedItems.indexOf(item);\r\n      // do we need to store a new reference to this object?\r\n      if (referenceIndex === -1) {\r\n        var clone = {};\r\n        referenceIndex = references.push({\r\n          contents: clone,\r\n          value: wrapConstructor(item)\r\n        }) - 1;\r\n        savedItems[referenceIndex] = item;\r\n        for (var key in item) {\r\n          if (options.isSerializable(item, key)) {\r\n            clone[key] = cloneWithReferences(item[key], references, options, savedItems);\r\n          }\r\n        }\r\n      }\r\n\r\n      // return something like _CRYO_REF_22\r\n      return REFERENCE_FLAG + referenceIndex;\r\n    }\r\n\r\n    // return a non-container object\r\n    return wrap(item);\r\n  }\r\n\r\n  function parse(string, options) {\r\n    var json = JSON.parse(string);\r\n\r\n    // Backward compatibility with 0.0.6 that exepects `options` to be a callback.\r\n    options = typeof options === 'function' ? { finalize: options } : options;\r\n    options = defaults(options || {}, { finalize: null });\r\n\r\n    return rebuildFromReferences(json.root, json.references, options);\r\n  }\r\n\r\n  function rebuildFromReferences(item, references, options, restoredItems) {\r\n    restoredItems = restoredItems || [];\r\n    if (starts(item, REFERENCE_FLAG)) {\r\n      var referenceIndex = parseInt(item.slice(REFERENCE_FLAG.length), 10);\r\n      if (!restoredItems.hasOwnProperty(referenceIndex)) {\r\n        var ref = references[referenceIndex];\r\n        var container = unwrapConstructor(ref.value);\r\n        var contents = ref.contents;\r\n        restoredItems[referenceIndex] = container;\r\n        for (var key in contents) {\r\n          container[key] = rebuildFromReferences(contents[key], references, options, restoredItems);\r\n        }\r\n      }\r\n\r\n      // invoke callback after all operations related to serializing the item\r\n      if (options.finalize) { options.finalize(restoredItems[referenceIndex]); }\r\n\r\n      return restoredItems[referenceIndex];\r\n    }\r\n\r\n    // invoke callback after all operations related to serializing the item\r\n    if (options.finalize) { options.finalize(item); }\r\n\r\n    return unwrap(item);\r\n  }\r\n\r\n  function wrap(item) {\r\n    var type = typeOf(item);\r\n    if (type === 'undefined') return UNDEFINED_FLAG;\r\n    if (type === 'function') return FUNCTION_FLAG + item.toString();\r\n    if (type === 'date') return DATE_FLAG + item.getTime();\r\n    if (item === Infinity) return INFINITY_FLAG;\r\n    if (type === 'dom') return undefined;\r\n    return item;\r\n  }\r\n\r\n  function wrapConstructor(item) {\r\n    var type = typeOf(item);\r\n    if (type === 'function' || type === 'date') return wrap(item);\r\n    if (type === 'object') return OBJECT_FLAG;\r\n    if (type === 'array') return ARRAY_FLAG;\r\n    return item;\r\n  }\r\n\r\n  function unwrapConstructor(val) {\r\n    if (typeOf(val) === 'string') {\r\n      if (val === UNDEFINED_FLAG) return undefined;\r\n      if (starts(val, FUNCTION_FLAG)) {\r\n        return (new Function(\"return \" + val.slice(FUNCTION_FLAG.length)))();\r\n      }\r\n      if (starts(val, DATE_FLAG)) {\r\n        var dateNum = parseInt(val.slice(DATE_FLAG.length), 10);\r\n        return new Date(dateNum);\r\n      }\r\n      if (starts(val, OBJECT_FLAG)) {\r\n        return {};\r\n      }\r\n      if (starts(val, ARRAY_FLAG)) {\r\n        return [];\r\n      }\r\n      if (val === INFINITY_FLAG) return Infinity;\r\n    }\r\n    return val;\r\n  }\r\n\r\n  function unwrap(val) {\r\n    if (typeOf(val) === 'string') {\r\n      if (val === UNDEFINED_FLAG) return undefined;\r\n      if (starts(val, FUNCTION_FLAG)) {\r\n        var fn = val.slice(FUNCTION_FLAG.length);\r\n        var argStart = fn.indexOf('(') + 1;\r\n        var argEnd = fn.indexOf(')', argStart);\r\n        var args = fn.slice(argStart, argEnd);\r\n        var bodyStart = fn.indexOf('{') + 1;\r\n        var bodyEnd = fn.lastIndexOf('}') - 1;\r\n        var body = fn.slice(bodyStart, bodyEnd);\r\n        return new Function(args, body);\r\n      }\r\n      if (starts(val, DATE_FLAG)) {\r\n        var dateNum = parseInt(val.slice(DATE_FLAG.length), 10);\r\n        return new Date(dateNum);\r\n      }\r\n      if (val === INFINITY_FLAG) return Infinity;\r\n    }\r\n    return val;\r\n  }\r\n\r\n  function starts(string, prefix) {\r\n    return typeOf(string) === 'string' && string.slice(0, prefix.length) === prefix;\r\n  }\r\n\r\n  function isNumber(n) {\r\n    return !isNaN(parseFloat(n)) && isFinite(n);\r\n  }\r\n\r\n  // Exported object\r\n  var Cryo = {\r\n    stringify: stringify,\r\n    parse: parse\r\n  };\r\n\r\n  // global on server, window in browser\r\n  var root = this;\r\n\r\n  // AMD / RequireJS\r\n  if (typeof define !== 'undefined' && define.amd) {\r\n    define('Cryo', [], function () {\r\n      return Cryo;\r\n    });\r\n  }\r\n\r\n  // node.js\r\n  else if (typeof module !== 'undefined' && module.exports) {\r\n    module.exports = Cryo;\r\n  }\r\n\r\n  // included directly via <script> tag\r\n  else {\r\n    root.Cryo = Cryo;\r\n  }\r\n\r\n})();\r\n"]},"metadata":{},"sourceType":"script"}