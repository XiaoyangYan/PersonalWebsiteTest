{"ast":null,"code":"var Duplex = require('readable-stream').Duplex;\n\nvar PassThrough = require('readable-stream').PassThrough;\n\nvar Readable = require('readable-stream').Readable;\n\nvar inherits = require('inherits');\n\nvar nextTick = typeof setImmediate !== 'undefined' ? setImmediate : process.nextTick;\nmodule.exports = Pipeline;\ninherits(Pipeline, Duplex);\n\nmodule.exports.obj = function (streams, opts) {\n  if (!opts && !Array.isArray(streams)) {\n    opts = streams;\n    streams = [];\n  }\n\n  if (!streams) streams = [];\n  if (!opts) opts = {};\n  opts.objectMode = true;\n  return new Pipeline(streams, opts);\n};\n\nfunction Pipeline(streams, opts) {\n  if (!(this instanceof Pipeline)) return new Pipeline(streams, opts);\n\n  if (!opts && !Array.isArray(streams)) {\n    opts = streams;\n    streams = [];\n  }\n\n  if (!streams) streams = [];\n  if (!opts) opts = {};\n  Duplex.call(this, opts);\n  var self = this;\n  this._options = opts;\n  this._wrapOptions = {\n    objectMode: opts.objectMode !== false\n  };\n  this._streams = [];\n  this.splice.apply(this, [0, 0].concat(streams));\n  this.once('finish', function () {\n    self._notEmpty();\n\n    self._streams[0].end();\n  });\n}\n\nPipeline.prototype._read = function () {\n  var self = this;\n\n  this._notEmpty();\n\n  var r = this._streams[this._streams.length - 1];\n  var buf,\n      reads = 0;\n\n  while ((buf = r.read()) !== null) {\n    Duplex.prototype.push.call(this, buf);\n    reads++;\n  }\n\n  if (reads === 0) {\n    var onreadable = function () {\n      r.removeListener('readable', onreadable);\n      self.removeListener('_mutate', onreadable);\n\n      self._read();\n    };\n\n    r.once('readable', onreadable);\n    self.once('_mutate', onreadable);\n  }\n};\n\nPipeline.prototype._write = function (buf, enc, next) {\n  this._notEmpty();\n\n  this._streams[0]._write(buf, enc, next);\n};\n\nPipeline.prototype._notEmpty = function () {\n  var self = this;\n  if (this._streams.length > 0) return;\n  var stream = new PassThrough(this._options);\n  stream.once('end', function () {\n    var ix = self._streams.indexOf(stream);\n\n    if (ix >= 0 && ix === self._streams.length - 1) {\n      Duplex.prototype.push.call(self, null);\n    }\n  });\n\n  this._streams.push(stream);\n\n  this.length = this._streams.length;\n};\n\nPipeline.prototype.push = function (stream) {\n  var args = [this._streams.length, 0].concat([].slice.call(arguments));\n  this.splice.apply(this, args);\n  return this._streams.length;\n};\n\nPipeline.prototype.pop = function () {\n  return this.splice(this._streams.length - 1, 1)[0];\n};\n\nPipeline.prototype.shift = function () {\n  return this.splice(0, 1)[0];\n};\n\nPipeline.prototype.unshift = function () {\n  this.splice.apply(this, [0, 0].concat([].slice.call(arguments)));\n  return this._streams.length;\n};\n\nPipeline.prototype.splice = function (start, removeLen) {\n  var self = this;\n  var len = this._streams.length;\n  start = start < 0 ? len - start : start;\n  if (removeLen === undefined) removeLen = len - start;\n  removeLen = Math.max(0, Math.min(len - start, removeLen));\n\n  for (var i = start; i < start + removeLen; i++) {\n    if (self._streams[i - 1]) {\n      self._streams[i - 1].unpipe(self._streams[i]);\n    }\n  }\n\n  if (self._streams[i - 1] && self._streams[i]) {\n    self._streams[i - 1].unpipe(self._streams[i]);\n  }\n\n  var end = i;\n  var reps = [],\n      args = arguments;\n\n  for (var j = 2; j < args.length; j++) (function (stream) {\n    if (Array.isArray(stream)) {\n      stream = new Pipeline(stream, self._options);\n    }\n\n    stream.on('error', function (err) {\n      err.stream = this;\n      self.emit('error', err);\n    });\n    stream = self._wrapStream(stream);\n    stream.once('end', function () {\n      var ix = self._streams.indexOf(stream);\n\n      if (ix >= 0 && ix === self._streams.length - 1) {\n        Duplex.prototype.push.call(self, null);\n      }\n    });\n    reps.push(stream);\n  })(arguments[j]);\n\n  for (var i = 0; i < reps.length - 1; i++) {\n    reps[i].pipe(reps[i + 1]);\n  }\n\n  if (reps.length && self._streams[end]) {\n    reps[reps.length - 1].pipe(self._streams[end]);\n  }\n\n  if (reps[0] && self._streams[start - 1]) {\n    self._streams[start - 1].pipe(reps[0]);\n  }\n\n  var sargs = [start, removeLen].concat(reps);\n\n  var removed = self._streams.splice.apply(self._streams, sargs);\n\n  for (var i = 0; i < reps.length; i++) {\n    reps[i].read(0);\n  }\n\n  this.emit('_mutate');\n  this.length = this._streams.length;\n  return removed;\n};\n\nPipeline.prototype.get = function () {\n  if (arguments.length === 0) return undefined;\n  var base = this;\n\n  for (var i = 0; i < arguments.length; i++) {\n    var index = arguments[i];\n\n    if (index < 0) {\n      base = base._streams[base._streams.length + index];\n    } else {\n      base = base._streams[index];\n    }\n\n    if (!base) return undefined;\n  }\n\n  return base;\n};\n\nPipeline.prototype.indexOf = function (stream) {\n  return this._streams.indexOf(stream);\n};\n\nPipeline.prototype._wrapStream = function (stream) {\n  if (typeof stream.read === 'function') return stream;\n  var w = new Readable(this._wrapOptions).wrap(stream);\n\n  w._write = function (buf, enc, next) {\n    if (stream.write(buf) === false) {\n      stream.once('drain', next);\n    } else nextTick(next);\n  };\n\n  return w;\n};","map":{"version":3,"sources":["/home/yanxiaoyang/react-project/PersonalWebsiteTest/node_modules/stream-splicer/index.js"],"names":["Duplex","require","PassThrough","Readable","inherits","nextTick","setImmediate","process","module","exports","Pipeline","obj","streams","opts","Array","isArray","objectMode","call","self","_options","_wrapOptions","_streams","splice","apply","concat","once","_notEmpty","end","prototype","_read","r","length","buf","reads","read","push","onreadable","removeListener","_write","enc","next","stream","ix","indexOf","args","slice","arguments","pop","shift","unshift","start","removeLen","len","undefined","Math","max","min","i","unpipe","reps","j","on","err","emit","_wrapStream","pipe","sargs","removed","get","base","index","w","wrap","write"],"mappings":"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","sourcesContent":["var Duplex = require('readable-stream').Duplex;\nvar PassThrough = require('readable-stream').PassThrough;\nvar Readable = require('readable-stream').Readable;\nvar inherits = require('inherits');\n\nvar nextTick = typeof setImmediate !== 'undefined'\n    ? setImmediate : process.nextTick\n;\n\nmodule.exports = Pipeline;\ninherits(Pipeline, Duplex);\n\nmodule.exports.obj = function (streams, opts) {\n    if (!opts && !Array.isArray(streams)) {\n        opts = streams;\n        streams = [];\n    }\n    if (!streams) streams = [];\n    if (!opts) opts = {};\n    opts.objectMode = true;\n    return new Pipeline(streams, opts);\n};\n\nfunction Pipeline (streams, opts) {\n    if (!(this instanceof Pipeline)) return new Pipeline(streams, opts);\n    if (!opts && !Array.isArray(streams)) {\n        opts = streams;\n        streams = [];\n    }\n    if (!streams) streams = [];\n    if (!opts) opts = {};\n    Duplex.call(this, opts);\n    \n    var self = this;\n    this._options = opts;\n    this._wrapOptions = { objectMode: opts.objectMode !== false };\n    this._streams = [];\n    \n    this.splice.apply(this, [ 0, 0 ].concat(streams));\n    \n    this.once('finish', function () {\n        self._notEmpty();\n        self._streams[0].end();\n    });\n}\n\nPipeline.prototype._read = function () {\n    var self = this;\n    this._notEmpty();\n    \n    var r = this._streams[this._streams.length-1];\n    var buf, reads = 0;\n    while ((buf = r.read()) !== null) {\n        Duplex.prototype.push.call(this, buf);\n        reads ++;\n    }\n    if (reads === 0) {\n        var onreadable = function () {\n            r.removeListener('readable', onreadable);\n            self.removeListener('_mutate', onreadable);\n            self._read()\n        };\n        r.once('readable', onreadable);\n        self.once('_mutate', onreadable);\n    }\n};\n\nPipeline.prototype._write = function (buf, enc, next) {\n    this._notEmpty();\n    this._streams[0]._write(buf, enc, next);\n};\n\nPipeline.prototype._notEmpty = function () {\n    var self = this;\n    if (this._streams.length > 0) return;\n    var stream = new PassThrough(this._options);\n    stream.once('end', function () {\n        var ix = self._streams.indexOf(stream);\n        if (ix >= 0 && ix === self._streams.length - 1) {\n            Duplex.prototype.push.call(self, null);\n        }\n    });\n    this._streams.push(stream);\n    this.length = this._streams.length;\n};\n\nPipeline.prototype.push = function (stream) {\n    var args = [ this._streams.length, 0 ].concat([].slice.call(arguments));\n    this.splice.apply(this, args);\n    return this._streams.length;\n};\n\nPipeline.prototype.pop = function () {\n    return this.splice(this._streams.length-1,1)[0];\n};\n\nPipeline.prototype.shift = function () {\n    return this.splice(0,1)[0];\n};\n\nPipeline.prototype.unshift = function () {\n    this.splice.apply(this, [0,0].concat([].slice.call(arguments)));\n    return this._streams.length;\n};\n\nPipeline.prototype.splice = function (start, removeLen) {\n    var self = this;\n    var len = this._streams.length;\n    start = start < 0 ? len - start : start;\n    if (removeLen === undefined) removeLen = len - start;\n    removeLen = Math.max(0, Math.min(len - start, removeLen));\n    \n    for (var i = start; i < start + removeLen; i++) {\n        if (self._streams[i-1]) {\n            self._streams[i-1].unpipe(self._streams[i]);\n        }\n    }\n    if (self._streams[i-1] && self._streams[i]) {\n        self._streams[i-1].unpipe(self._streams[i]);\n    }\n    var end = i;\n    \n    var reps = [], args = arguments;\n    for (var j = 2; j < args.length; j++) (function (stream) {\n        if (Array.isArray(stream)) {\n            stream = new Pipeline(stream, self._options);\n        }\n        stream.on('error', function (err) {\n            err.stream = this;\n            self.emit('error', err);\n        });\n        stream = self._wrapStream(stream);\n        stream.once('end', function () {\n            var ix = self._streams.indexOf(stream);\n            if (ix >= 0 && ix === self._streams.length - 1) {\n                Duplex.prototype.push.call(self, null);\n            }\n        });\n        reps.push(stream);\n    })(arguments[j]);\n    \n    for (var i = 0; i < reps.length - 1; i++) {\n        reps[i].pipe(reps[i+1]);\n    }\n    \n    if (reps.length && self._streams[end]) {\n        reps[reps.length-1].pipe(self._streams[end]);\n    }\n    if (reps[0] && self._streams[start-1]) {\n        self._streams[start-1].pipe(reps[0]);\n    }\n    \n    var sargs = [start,removeLen].concat(reps);\n    var removed = self._streams.splice.apply(self._streams, sargs);\n    \n    for (var i = 0; i < reps.length; i++) {\n        reps[i].read(0);\n    }\n    \n    this.emit('_mutate');\n    this.length = this._streams.length;\n    return removed;\n};\n\nPipeline.prototype.get = function () {\n    if (arguments.length === 0) return undefined;\n    \n    var base = this;\n    for (var i = 0; i < arguments.length; i++) {\n        var index = arguments[i];\n        if (index < 0) {\n            base = base._streams[base._streams.length + index];\n        }\n        else {\n            base = base._streams[index];\n        }\n        if (!base) return undefined;\n    }\n    return base;\n};\n\nPipeline.prototype.indexOf = function (stream) {\n    return this._streams.indexOf(stream);\n};\n\nPipeline.prototype._wrapStream = function (stream) {\n    if (typeof stream.read === 'function') return stream;\n    var w = new Readable(this._wrapOptions).wrap(stream);\n    w._write = function (buf, enc, next) {\n        if (stream.write(buf) === false) {\n            stream.once('drain', next);\n        }\n        else nextTick(next);\n    };\n    return w;\n};\n"]},"metadata":{},"sourceType":"script"}