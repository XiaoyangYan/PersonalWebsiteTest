{"ast":null,"code":"var fs = require('fs');\n\nvar path = require('path');\n\nvar relativePath = require('cached-path-relative');\n\nvar browserResolve = require('browser-resolve');\n\nvar nodeResolve = require('resolve');\n\nvar detective = require('detective');\n\nvar through = require('through2');\n\nvar concat = require('concat-stream');\n\nvar parents = require('parents');\n\nvar combine = require('stream-combiner2');\n\nvar duplexer = require('duplexer2');\n\nvar xtend = require('xtend');\n\nvar defined = require('defined');\n\nvar inherits = require('inherits');\n\nvar Transform = require('readable-stream').Transform;\n\nmodule.exports = Deps;\ninherits(Deps, Transform);\n\nfunction Deps(opts) {\n  var self = this;\n  if (!(this instanceof Deps)) return new Deps(opts);\n  Transform.call(this, {\n    objectMode: true\n  });\n  if (!opts) opts = {};\n  this.basedir = opts.basedir || process.cwd();\n\n  this.persistentCache = opts.persistentCache || function (file, id, pkg, fallback, cb) {\n    process.nextTick(function () {\n      fallback(null, cb);\n    });\n  };\n\n  this.cache = opts.cache;\n  this.fileCache = opts.fileCache;\n  this.pkgCache = opts.packageCache || {};\n  this.pkgFileCache = {};\n  this.pkgFileCachePending = {};\n  this._emittedPkg = {};\n  this.visited = {};\n  this.walking = {};\n  this.entries = [];\n  this._input = [];\n  this.paths = opts.paths || process.env.NODE_PATH || '';\n\n  if (typeof this.paths === 'string') {\n    var delimiter = path.delimiter || (process.platform === 'win32' ? ';' : ':');\n    this.paths = this.paths.split(delimiter);\n  }\n\n  this.paths = this.paths.filter(Boolean).map(function (p) {\n    return path.resolve(self.basedir, p);\n  });\n  this.transforms = [].concat(opts.transform).filter(Boolean);\n  this.globalTransforms = [].concat(opts.globalTransform).filter(Boolean);\n  this.resolver = opts.resolve || browserResolve;\n  this.options = xtend(opts);\n  if (!this.options.modules) this.options.modules = {}; // If the caller passes options.expose, store resolved pathnames for exposed\n  // modules in it. If not, set it anyway so it's defined later.\n\n  if (!this.options.expose) this.options.expose = {};\n  this.pending = 0;\n  this.inputPending = 0;\n  var topfile = path.join(this.basedir, '__fake.js');\n  this.top = {\n    id: topfile,\n    filename: topfile,\n    paths: this.paths,\n    basedir: this.basedir\n  };\n}\n\nDeps.prototype._isTopLevel = function (file) {\n  var isTopLevel = this.entries.some(function (main) {\n    var m = relativePath(path.dirname(main), file);\n    return m.split(/[\\\\\\/]/).indexOf('node_modules') < 0;\n  });\n\n  if (!isTopLevel) {\n    var m = relativePath(this.basedir, file);\n    isTopLevel = m.split(/[\\\\\\/]/).indexOf('node_modules') < 0;\n  }\n\n  return isTopLevel;\n};\n\nDeps.prototype._transform = function (row, enc, next) {\n  var self = this;\n\n  if (typeof row === 'string') {\n    row = {\n      file: row\n    };\n  }\n\n  if (row.transform && row.global) {\n    this.globalTransforms.push([row.transform, row.options]);\n    return next();\n  } else if (row.transform) {\n    this.transforms.push([row.transform, row.options]);\n    return next();\n  }\n\n  self.pending++;\n  var basedir = defined(row.basedir, self.basedir);\n\n  if (row.entry !== false) {\n    self.entries.push(path.resolve(basedir, row.file || row.id));\n  }\n\n  self.lookupPackage(row.file, function (err, pkg) {\n    if (err && self.options.ignoreMissing) {\n      self.emit('missing', row.file, self.top);\n      self.pending--;\n      return next();\n    }\n\n    if (err) return self.emit('error', err);\n    self.pending--;\n\n    self._input.push({\n      row: row,\n      pkg: pkg\n    });\n\n    next();\n  });\n};\n\nDeps.prototype._flush = function () {\n  var self = this;\n  var files = {};\n\n  self._input.forEach(function (r) {\n    var w = r.row,\n        f = files[w.file || w.id];\n\n    if (f) {\n      f.row.entry = f.row.entry || w.entry;\n      var ex = f.row.expose || w.expose;\n      f.row.expose = ex;\n\n      if (ex && f.row.file === f.row.id && w.file !== w.id) {\n        f.row.id = w.id;\n      }\n    } else files[w.file || w.id] = r;\n  });\n\n  Object.keys(files).forEach(function (key) {\n    var r = files[key];\n    var pkg = r.pkg || {};\n    var dir = r.row.file ? path.dirname(r.row.file) : self.basedir;\n    if (!pkg.__dirname) pkg.__dirname = dir;\n    self.walk(r.row, xtend(self.top, {\n      filename: path.join(dir, '_fake.js')\n    }));\n  });\n  if (this.pending === 0) this.push(null);\n  this._ended = true;\n};\n\nDeps.prototype.resolve = function (id, parent, cb) {\n  var self = this;\n  var opts = self.options;\n\n  if (xhas(self.cache, parent.id, 'deps', id) && self.cache[parent.id].deps[id]) {\n    var file = self.cache[parent.id].deps[id];\n    var pkg = self.pkgCache[file];\n    if (pkg) return cb(null, file, pkg);\n    return self.lookupPackage(file, function (err, pkg) {\n      cb(null, file, pkg);\n    });\n  }\n\n  parent.packageFilter = function (p, x) {\n    var pkgdir = path.dirname(x);\n    if (opts.packageFilter) p = opts.packageFilter(p, x);\n    p.__dirname = pkgdir;\n    return p;\n  };\n\n  if (opts.extensions) parent.extensions = opts.extensions;\n  if (opts.modules) parent.modules = opts.modules;\n  self.resolver(id, parent, function onresolve(err, file, pkg, fakePath) {\n    if (err) return cb(err);\n    if (!file) return cb(new Error('module not found: \"' + id + '\" from file ' + parent.filename));\n\n    if (!pkg || !pkg.__dirname) {\n      self.lookupPackage(file, function (err, p) {\n        if (err) return cb(err);\n        if (!p) p = {};\n        if (!p.__dirname) p.__dirname = path.dirname(file);\n        self.pkgCache[file] = p;\n        onresolve(err, file, opts.packageFilter ? opts.packageFilter(p, p.__dirname) : p, fakePath);\n      });\n    } else cb(err, file, pkg, fakePath);\n  });\n};\n\nDeps.prototype.readFile = function (file, id, pkg) {\n  var self = this;\n\n  if (xhas(this.fileCache, file)) {\n    return toStream(this.fileCache[file]);\n  }\n\n  var rs = fs.createReadStream(file, {\n    encoding: 'utf8'\n  });\n  rs.on('error', function (err) {\n    self.emit('error', err);\n  });\n  this.emit('file', file, id);\n  return rs;\n};\n\nDeps.prototype.getTransforms = function (file, pkg, opts) {\n  if (!opts) opts = {};\n  var self = this;\n  var isTopLevel;\n  if (opts.builtin || opts.inNodeModules) isTopLevel = false;else isTopLevel = this._isTopLevel(file);\n  var transforms = [].concat(isTopLevel ? this.transforms : []).concat(getTransforms(pkg, {\n    globalTransform: this.globalTransforms,\n    transformKey: this.options.transformKey\n  }));\n  if (transforms.length === 0) return through();\n  var pending = transforms.length;\n  var streams = [];\n  var input = through();\n  var output = through();\n  var dup = duplexer(input, output);\n\n  for (var i = 0; i < transforms.length; i++) (function (i) {\n    makeTransform(transforms[i], function (err, trs) {\n      if (err) return self.emit('error', err);\n      streams[i] = trs;\n      if (--pending === 0) done();\n    });\n  })(i);\n\n  return dup;\n\n  function done() {\n    var middle = combine.apply(null, streams);\n    middle.on('error', function (err) {\n      err.message += ' while parsing file: ' + file;\n      if (!err.filename) err.filename = file;\n      self.emit('error', err);\n    });\n    input.pipe(middle).pipe(output);\n  }\n\n  function makeTransform(tr, cb) {\n    var trOpts = {};\n\n    if (Array.isArray(tr)) {\n      trOpts = tr[1] || {};\n      tr = tr[0];\n    }\n\n    trOpts._flags = trOpts.hasOwnProperty('_flags') ? trOpts._flags : self.options;\n\n    if (typeof tr === 'function') {\n      var t = tr(file, trOpts);\n      self.emit('transform', t, file);\n      nextTick(cb, null, wrapTransform(t));\n    } else {\n      loadTransform(tr, trOpts, function (err, trs) {\n        if (err) return cb(err);\n        cb(null, wrapTransform(trs));\n      });\n    }\n  }\n\n  function loadTransform(id, trOpts, cb) {\n    var params = {\n      basedir: path.dirname(file)\n    };\n    nodeResolve(id, params, function nr(err, res, again) {\n      if (err && again) return cb && cb(err);\n\n      if (err) {\n        params.basedir = pkg.__dirname;\n        return nodeResolve(id, params, function (e, r) {\n          nr(e, r, true);\n        });\n      }\n\n      if (!res) return cb(new Error('cannot find transform module ' + tr + ' while transforming ' + file));\n\n      var r = require(res);\n\n      if (typeof r !== 'function') {\n        return cb(new Error('Unexpected ' + typeof r + ' exported by the ' + JSON.stringify(res) + ' package. ' + 'Expected a transform function.'));\n      }\n\n      var trs = r(file, trOpts);\n      self.emit('transform', trs, file);\n      cb(null, trs);\n    });\n  }\n};\n\nDeps.prototype.walk = function (id, parent, cb) {\n  var self = this;\n  var opts = self.options;\n  this.pending++;\n  var rec = {};\n  var input;\n\n  if (typeof id === 'object') {\n    rec = xtend(id);\n    if (rec.entry === false) delete rec.entry;\n    id = rec.file || rec.id;\n    input = true;\n    this.inputPending++;\n  }\n\n  self.resolve(id, parent, function (err, file, pkg, fakePath) {\n    // this is checked early because parent.modules is also modified\n    // by this function.\n    var builtin = has(parent.modules, id);\n\n    if (rec.expose) {\n      // Set options.expose to make the resolved pathname available to the\n      // caller. They may or may not have requested it, but it's harmless\n      // to set this if they didn't.\n      self.options.expose[rec.expose] = self.options.modules[rec.expose] = file;\n    }\n\n    if (pkg && !self._emittedPkg[pkg.__dirname]) {\n      self._emittedPkg[pkg.__dirname] = true;\n      self.emit('package', pkg);\n    }\n\n    if (opts.postFilter && !opts.postFilter(id, file, pkg)) {\n      if (--self.pending === 0) self.push(null);\n      if (input) --self.inputPending;\n      return cb && cb(null, undefined);\n    }\n\n    if (err && rec.source) {\n      file = rec.file;\n      var ts = self.getTransforms(file, pkg);\n      ts.pipe(concat(function (body) {\n        rec.source = body.toString('utf8');\n        fromSource(file, rec.source, pkg);\n      }));\n      return ts.end(rec.source);\n    }\n\n    if (err && self.options.ignoreMissing) {\n      if (--self.pending === 0) self.push(null);\n      if (input) --self.inputPending;\n      self.emit('missing', id, parent);\n      return cb && cb(null, undefined);\n    }\n\n    if (err) return self.emit('error', err);\n\n    if (self.visited[file]) {\n      if (--self.pending === 0) self.push(null);\n      if (input) --self.inputPending;\n      return cb && cb(null, file);\n    }\n\n    self.visited[file] = true;\n\n    if (rec.source) {\n      var ts = self.getTransforms(file, pkg);\n      ts.pipe(concat(function (body) {\n        rec.source = body.toString('utf8');\n        fromSource(file, rec.source, pkg);\n      }));\n      return ts.end(rec.source);\n    }\n\n    var c = self.cache && self.cache[file];\n    if (c) return fromDeps(file, c.source, c.package, fakePath, Object.keys(c.deps));\n    self.persistentCache(file, id, pkg, persistentCacheFallback, function (err, c) {\n      if (err) {\n        self.emit('error', err);\n        return;\n      }\n\n      fromDeps(file, c.source, c.package, fakePath, Object.keys(c.deps));\n    });\n\n    function persistentCacheFallback(dataAsString, cb) {\n      var stream = dataAsString ? toStream(dataAsString) : self.readFile(file, id, pkg);\n      stream.pipe(self.getTransforms(fakePath || file, pkg, {\n        builtin: builtin,\n        inNodeModules: parent.inNodeModules\n      })).pipe(concat(function (body) {\n        var src = body.toString('utf8');\n        var deps = getDeps(file, src);\n\n        if (deps) {\n          cb(null, {\n            source: src,\n            package: pkg,\n            deps: deps.reduce(function (deps, dep) {\n              deps[dep] = true;\n              return deps;\n            }, {})\n          });\n        }\n      }));\n    }\n  });\n\n  function getDeps(file, src) {\n    return rec.noparse ? [] : self.parseDeps(file, src);\n  }\n\n  function fromSource(file, src, pkg, fakePath) {\n    var deps = getDeps(file, src);\n    if (deps) fromDeps(file, src, pkg, fakePath, deps);\n  }\n\n  function fromDeps(file, src, pkg, fakePath, deps) {\n    var p = deps.length;\n    var resolved = {};\n    if (input) --self.inputPending;\n\n    (function resolve() {\n      if (self.inputPending > 0) return setTimeout(resolve);\n      deps.forEach(function (id) {\n        if (opts.filter && !opts.filter(id)) {\n          resolved[id] = false;\n          if (--p === 0) done();\n          return;\n        }\n\n        var isTopLevel = self._isTopLevel(fakePath || file);\n\n        var current = {\n          id: file,\n          filename: file,\n          paths: self.paths,\n          package: pkg,\n          inNodeModules: parent.inNodeModules || !isTopLevel\n        };\n        self.walk(id, current, function (err, r) {\n          resolved[id] = r;\n          if (--p === 0) done();\n        });\n      });\n      if (deps.length === 0) done();\n    })();\n\n    function done() {\n      if (!rec.id) rec.id = file;\n      if (!rec.source) rec.source = src;\n      if (!rec.deps) rec.deps = resolved;\n      if (!rec.file) rec.file = file;\n\n      if (self.entries.indexOf(file) >= 0) {\n        rec.entry = true;\n      }\n\n      self.push(rec);\n      if (cb) cb(null, file);\n      if (--self.pending === 0) self.push(null);\n    }\n  }\n};\n\nDeps.prototype.parseDeps = function (file, src, cb) {\n  if (this.options.noParse === true) return [];\n  if (/\\.json$/.test(file)) return [];\n\n  if (Array.isArray(this.options.noParse) && this.options.noParse.indexOf(file) >= 0) {\n    return [];\n  }\n\n  try {\n    var deps = detective(src);\n  } catch (ex) {\n    var message = ex && ex.message ? ex.message : ex;\n    this.emit('error', new Error('Parsing file ' + file + ': ' + message));\n    return;\n  }\n\n  return deps;\n};\n\nDeps.prototype.lookupPackage = function (file, cb) {\n  var self = this;\n  var cached = this.pkgCache[file];\n  if (cached) return nextTick(cb, null, cached);\n  if (cached === false) return nextTick(cb, null, undefined);\n  var dirs = parents(file ? path.dirname(file) : self.basedir);\n\n  (function next() {\n    if (dirs.length === 0) {\n      self.pkgCache[file] = false;\n      return cb(null, undefined);\n    }\n\n    var dir = dirs.shift();\n\n    if (dir.split(/[\\\\\\/]/).slice(-1)[0] === 'node_modules') {\n      return cb(null, undefined);\n    }\n\n    var pkgfile = path.join(dir, 'package.json');\n    var cached = self.pkgCache[pkgfile];\n    if (cached) return nextTick(cb, null, cached);else if (cached === false) return next();\n    var pcached = self.pkgFileCachePending[pkgfile];\n    if (pcached) return pcached.push(onpkg);\n    pcached = self.pkgFileCachePending[pkgfile] = [];\n    fs.readFile(pkgfile, function (err, src) {\n      if (err) return onpkg();\n\n      try {\n        var pkg = JSON.parse(src);\n      } catch (err) {\n        return onpkg(new Error([err + ' while parsing json file ' + pkgfile].join('')));\n      }\n\n      pkg.__dirname = dir;\n      self.pkgCache[pkgfile] = pkg;\n      self.pkgCache[file] = pkg;\n      onpkg(null, pkg);\n    });\n\n    function onpkg(err, pkg) {\n      if (self.pkgFileCachePending[pkgfile]) {\n        var fns = self.pkgFileCachePending[pkgfile];\n        delete self.pkgFileCachePending[pkgfile];\n        fns.forEach(function (f) {\n          f(err, pkg);\n        });\n      }\n\n      if (err) cb(err);else if (pkg) cb(null, pkg);else {\n        self.pkgCache[pkgfile] = false;\n        next();\n      }\n    }\n  })();\n};\n\nfunction getTransforms(pkg, opts) {\n  var trx = [];\n\n  if (opts.transformKey) {\n    var n = pkg;\n    var keys = opts.transformKey;\n\n    for (var i = 0; i < keys.length; i++) {\n      if (n && typeof n === 'object') n = n[keys[i]];else break;\n    }\n\n    if (i === keys.length) {\n      trx = [].concat(n).filter(Boolean);\n    }\n  }\n\n  return trx.concat(opts.globalTransform || []);\n}\n\nfunction nextTick(cb) {\n  var args = [].slice.call(arguments, 1);\n  process.nextTick(function () {\n    cb.apply(null, args);\n  });\n}\n\nfunction xhas(obj) {\n  if (!obj) return false;\n\n  for (var i = 1; i < arguments.length; i++) {\n    var key = arguments[i];\n    if (!has(obj, key)) return false;\n    obj = obj[key];\n  }\n\n  return true;\n}\n\nfunction toStream(dataAsString) {\n  var tr = through();\n  tr.push(dataAsString);\n  tr.push(null);\n  return tr;\n}\n\nfunction has(obj, key) {\n  return obj && Object.prototype.hasOwnProperty.call(obj, key);\n}\n\nfunction wrapTransform(tr) {\n  if (typeof tr.read === 'function') return tr;\n  var input = through(),\n      output = through();\n  input.pipe(tr).pipe(output);\n  var wrapper = duplexer(input, output);\n  tr.on('error', function (err) {\n    wrapper.emit('error', err);\n  });\n  return wrapper;\n}","map":{"version":3,"sources":["/home/yanxiaoyang/react-project/PersonalWebsiteTest/node_modules/module-deps/index.js"],"names":["fs","require","path","relativePath","browserResolve","nodeResolve","detective","through","concat","parents","combine","duplexer","xtend","defined","inherits","Transform","module","exports","Deps","opts","self","call","objectMode","basedir","process","cwd","persistentCache","file","id","pkg","fallback","cb","nextTick","cache","fileCache","pkgCache","packageCache","pkgFileCache","pkgFileCachePending","_emittedPkg","visited","walking","entries","_input","paths","env","NODE_PATH","delimiter","platform","split","filter","Boolean","map","p","resolve","transforms","transform","globalTransforms","globalTransform","resolver","options","modules","expose","pending","inputPending","topfile","join","top","filename","prototype","_isTopLevel","isTopLevel","some","main","m","dirname","indexOf","_transform","row","enc","next","global","push","entry","lookupPackage","err","ignoreMissing","emit","_flush","files","forEach","r","w","f","ex","Object","keys","key","dir","__dirname","walk","_ended","parent","xhas","deps","packageFilter","x","pkgdir","extensions","onresolve","fakePath","Error","readFile","toStream","rs","createReadStream","encoding","on","getTransforms","builtin","inNodeModules","transformKey","length","streams","input","output","dup","i","makeTransform","trs","done","middle","apply","message","pipe","tr","trOpts","Array","isArray","_flags","hasOwnProperty","t","wrapTransform","loadTransform","params","nr","res","again","e","JSON","stringify","rec","has","postFilter","undefined","source","ts","body","toString","fromSource","end","c","fromDeps","package","persistentCacheFallback","dataAsString","stream","src","getDeps","reduce","dep","noparse","parseDeps","resolved","setTimeout","current","noParse","test","cached","dirs","shift","slice","pkgfile","pcached","onpkg","parse","fns","trx","n","args","arguments","obj","read","wrapper"],"mappings":"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","sourcesContent":["var fs = require('fs');\nvar path = require('path');\nvar relativePath = require('cached-path-relative')\n\nvar browserResolve = require('browser-resolve');\nvar nodeResolve = require('resolve');\nvar detective = require('detective');\nvar through = require('through2');\nvar concat = require('concat-stream');\nvar parents = require('parents');\nvar combine = require('stream-combiner2');\nvar duplexer = require('duplexer2');\nvar xtend = require('xtend');\nvar defined = require('defined');\n\nvar inherits = require('inherits');\nvar Transform = require('readable-stream').Transform;\n\nmodule.exports = Deps;\ninherits(Deps, Transform);\n\nfunction Deps (opts) {\n    var self = this;\n    if (!(this instanceof Deps)) return new Deps(opts);\n    Transform.call(this, { objectMode: true });\n    \n    if (!opts) opts = {};\n    \n    this.basedir = opts.basedir || process.cwd();\n    this.persistentCache = opts.persistentCache || function (file, id, pkg, fallback, cb) {\n        process.nextTick(function () {\n            fallback(null, cb);\n        });\n    };\n    this.cache = opts.cache;\n    this.fileCache = opts.fileCache;\n    this.pkgCache = opts.packageCache || {};\n    this.pkgFileCache = {};\n    this.pkgFileCachePending = {};\n    this._emittedPkg = {};\n    this.visited = {};\n    this.walking = {};\n    this.entries = [];\n    this._input = [];\n    \n    this.paths = opts.paths || process.env.NODE_PATH || '';\n    if (typeof this.paths === 'string') {\n        var delimiter = path.delimiter || (process.platform === 'win32' ? ';' : ':');\n        this.paths = this.paths.split(delimiter);\n    }\n    this.paths = this.paths\n        .filter(Boolean)\n        .map(function (p) {\n            return path.resolve(self.basedir, p);\n        });\n    \n    this.transforms = [].concat(opts.transform).filter(Boolean);\n    this.globalTransforms = [].concat(opts.globalTransform).filter(Boolean);\n    this.resolver = opts.resolve || browserResolve;\n    this.options = xtend(opts);\n    if (!this.options.modules) this.options.modules = {};\n\n    // If the caller passes options.expose, store resolved pathnames for exposed\n    // modules in it. If not, set it anyway so it's defined later.\n    if (!this.options.expose) this.options.expose = {};\n    this.pending = 0;\n    this.inputPending = 0;\n    \n    var topfile = path.join(this.basedir, '__fake.js');\n    this.top = {\n        id: topfile,\n        filename: topfile,\n        paths: this.paths,\n        basedir: this.basedir\n    };\n}\n\nDeps.prototype._isTopLevel = function (file) {\n    var isTopLevel = this.entries.some(function (main) {\n        var m = relativePath(path.dirname(main), file);\n        return m.split(/[\\\\\\/]/).indexOf('node_modules') < 0;\n    });\n    if (!isTopLevel) {\n        var m = relativePath(this.basedir, file);\n        isTopLevel = m.split(/[\\\\\\/]/).indexOf('node_modules') < 0;\n    }\n    return isTopLevel;\n};\n\nDeps.prototype._transform = function (row, enc, next) {\n    var self = this;\n    if (typeof row === 'string') {\n        row = { file: row };\n    }\n    if (row.transform && row.global) {\n        this.globalTransforms.push([ row.transform, row.options ]);\n        return next();\n    }\n    else if (row.transform) {\n        this.transforms.push([ row.transform, row.options ]);\n        return next();\n    }\n    \n    self.pending ++;\n    var basedir = defined(row.basedir, self.basedir);\n    \n    if (row.entry !== false) {\n        self.entries.push(path.resolve(basedir, row.file || row.id));\n    }\n    \n    self.lookupPackage(row.file, function (err, pkg) {\n        if (err && self.options.ignoreMissing) {\n            self.emit('missing', row.file, self.top);\n            self.pending --;\n            return next();\n        }\n        if (err) return self.emit('error', err)\n        self.pending --;\n        self._input.push({ row: row, pkg: pkg });\n        next();\n    });\n};\n\nDeps.prototype._flush = function () {\n    var self = this;\n    var files = {};\n    self._input.forEach(function (r) {\n        var w = r.row, f = files[w.file || w.id];\n        if (f) {\n            f.row.entry = f.row.entry || w.entry;\n            var ex = f.row.expose || w.expose;\n            f.row.expose = ex;\n            if (ex && f.row.file === f.row.id && w.file !== w.id) {\n                f.row.id = w.id;\n            }\n        }\n        else files[w.file || w.id] = r;\n    });\n    \n    Object.keys(files).forEach(function (key) {\n        var r = files[key];\n        var pkg = r.pkg || {};\n        var dir = r.row.file ? path.dirname(r.row.file) : self.basedir;\n        if (!pkg.__dirname) pkg.__dirname = dir;\n        self.walk(r.row, xtend(self.top, {\n            filename: path.join(dir, '_fake.js')\n        }));\n    });\n    if (this.pending === 0) this.push(null);\n    this._ended = true;\n};\n\nDeps.prototype.resolve = function (id, parent, cb) {\n    var self = this;\n    var opts = self.options;\n    \n    if (xhas(self.cache, parent.id, 'deps', id)\n    && self.cache[parent.id].deps[id]) {\n        var file = self.cache[parent.id].deps[id];\n        var pkg = self.pkgCache[file];\n        if (pkg) return cb(null, file, pkg);\n        return self.lookupPackage(file, function (err, pkg) {\n            cb(null, file, pkg);\n        });\n    }\n    \n    parent.packageFilter = function (p, x) {\n        var pkgdir = path.dirname(x);\n        if (opts.packageFilter) p = opts.packageFilter(p, x);\n        p.__dirname = pkgdir;\n\n        return p;\n    };\n    \n    if (opts.extensions) parent.extensions = opts.extensions;\n    if (opts.modules) parent.modules = opts.modules;\n    \n    self.resolver(id, parent, function onresolve (err, file, pkg, fakePath) {\n        if (err) return cb(err);\n        if (!file) return cb(new Error(\n            'module not found: \"' + id + '\" from file '\n            + parent.filename\n        ));\n        \n        if (!pkg || !pkg.__dirname) {\n            self.lookupPackage(file, function (err, p) {\n                if (err) return cb(err);\n                if (!p) p = {};\n                if (!p.__dirname) p.__dirname = path.dirname(file);\n                self.pkgCache[file] = p;\n                onresolve(err, file, opts.packageFilter\n                    ? opts.packageFilter(p, p.__dirname) : p,\n                    fakePath\n                );\n            });\n        }\n        else cb(err, file, pkg, fakePath);\n    });\n};\n\nDeps.prototype.readFile = function (file, id, pkg) {\n    var self = this;\n    if (xhas(this.fileCache, file)) {\n        return toStream(this.fileCache[file]);\n    }\n    var rs = fs.createReadStream(file, {\n        encoding: 'utf8'\n    });\n    rs.on('error', function (err) { self.emit('error', err) });\n    this.emit('file', file, id);\n    return rs;\n};\n\nDeps.prototype.getTransforms = function (file, pkg, opts) {\n    if (!opts) opts = {};\n    var self = this;\n    \n    var isTopLevel;\n    if (opts.builtin || opts.inNodeModules) isTopLevel = false;\n    else isTopLevel = this._isTopLevel(file);\n    \n    var transforms = [].concat(isTopLevel ? this.transforms : [])\n        .concat(getTransforms(pkg, {\n            globalTransform: this.globalTransforms,\n            transformKey: this.options.transformKey\n        }))\n    ;\n    if (transforms.length === 0) return through();\n    \n    var pending = transforms.length;\n    var streams = [];\n    var input = through();\n    var output = through();\n    var dup = duplexer(input, output);\n    \n    for (var i = 0; i < transforms.length; i++) (function (i) {\n        makeTransform(transforms[i], function (err, trs) {\n            if (err) return self.emit('error', err)\n            streams[i] = trs;\n            if (-- pending === 0) done();\n        });\n    })(i);\n    return dup;\n    \n    function done () {\n        var middle = combine.apply(null, streams);\n        middle.on('error', function (err) {\n            err.message += ' while parsing file: ' + file;\n            if (!err.filename) err.filename = file;\n            self.emit('error', err);\n        });\n        input.pipe(middle).pipe(output);\n    }\n    \n    function makeTransform (tr, cb) {\n        var trOpts = {};\n        if (Array.isArray(tr)) {\n            trOpts = tr[1] || {};\n            tr = tr[0];\n        }\n        trOpts._flags = trOpts.hasOwnProperty('_flags') ? trOpts._flags : self.options;\n        if (typeof tr === 'function') {\n            var t = tr(file, trOpts);\n            self.emit('transform', t, file);\n            nextTick(cb, null, wrapTransform(t));\n        }\n        else {\n            loadTransform(tr, trOpts, function (err, trs) {\n                if (err) return cb(err);\n                cb(null, wrapTransform(trs));\n            });\n        }\n    }\n    \n    function loadTransform (id, trOpts, cb) {\n        var params = { basedir: path.dirname(file) };\n        nodeResolve(id, params, function nr (err, res, again) {\n            if (err && again) return cb && cb(err);\n            \n            if (err) {\n                params.basedir = pkg.__dirname;\n                return nodeResolve(id, params, function (e, r) {\n                    nr(e, r, true)\n                });\n            }\n            \n            if (!res) return cb(new Error(\n                'cannot find transform module ' + tr\n                + ' while transforming ' + file\n            ));\n            \n            var r = require(res);\n            if (typeof r !== 'function') {\n                return cb(new Error(\n                    'Unexpected ' + typeof r + ' exported by the '\n                    + JSON.stringify(res) + ' package. '\n                    + 'Expected a transform function.'\n                ));\n            }\n            \n            var trs = r(file, trOpts);\n            self.emit('transform', trs, file);\n            cb(null, trs);\n        });\n    }\n};\n\nDeps.prototype.walk = function (id, parent, cb) {\n    var self = this;\n    var opts = self.options;\n    this.pending ++;\n    \n    var rec = {};\n    var input;\n    if (typeof id === 'object') {\n        rec = xtend(id);\n        if (rec.entry === false) delete rec.entry;\n        id = rec.file || rec.id;\n        input = true;\n        this.inputPending ++;\n    }\n    \n    self.resolve(id, parent, function (err, file, pkg, fakePath) {\n        // this is checked early because parent.modules is also modified\n        // by this function.\n        var builtin = has(parent.modules, id);\n\n        if (rec.expose) {\n            // Set options.expose to make the resolved pathname available to the\n            // caller. They may or may not have requested it, but it's harmless\n            // to set this if they didn't.\n            self.options.expose[rec.expose] =\n                self.options.modules[rec.expose] = file;\n        }\n        if (pkg && !self._emittedPkg[pkg.__dirname]) {\n            self._emittedPkg[pkg.__dirname] = true;\n            self.emit('package', pkg);\n        }\n        \n        if (opts.postFilter && !opts.postFilter(id, file, pkg)) {\n            if (--self.pending === 0) self.push(null);\n            if (input) --self.inputPending;\n            return cb && cb(null, undefined);\n        }\n        if (err && rec.source) {\n            file = rec.file;\n            \n            var ts = self.getTransforms(file, pkg);\n            ts.pipe(concat(function (body) {\n                rec.source = body.toString('utf8');\n                fromSource(file, rec.source, pkg);\n            }));\n            return ts.end(rec.source);\n        }\n        if (err && self.options.ignoreMissing) {\n            if (--self.pending === 0) self.push(null);\n            if (input) --self.inputPending;\n            self.emit('missing', id, parent);\n            return cb && cb(null, undefined);\n        }\n        if (err) return self.emit('error', err);\n        if (self.visited[file]) {\n            if (-- self.pending === 0) self.push(null);\n            if (input) --self.inputPending;\n            return cb && cb(null, file);\n        }\n        self.visited[file] = true;\n        \n        if (rec.source) {\n            var ts = self.getTransforms(file, pkg);\n            ts.pipe(concat(function (body) {\n                rec.source = body.toString('utf8');\n                fromSource(file, rec.source, pkg);\n            }));\n            return ts.end(rec.source);\n        }\n        \n        var c = self.cache && self.cache[file];\n        if (c) return fromDeps(file, c.source, c.package, fakePath, Object.keys(c.deps));\n        \n        self.persistentCache(file, id, pkg, persistentCacheFallback, function (err, c) {\n            if (err) {\n                self.emit('error', err);\n                return;\n            }\n            fromDeps(file, c.source, c.package, fakePath, Object.keys(c.deps));\n        });\n\n        function persistentCacheFallback (dataAsString, cb) {\n            var stream = dataAsString ? toStream(dataAsString) : self.readFile(file, id, pkg);\n            stream\n                .pipe(self.getTransforms(fakePath || file, pkg, {\n                    builtin: builtin,\n                    inNodeModules: parent.inNodeModules\n                }))\n                .pipe(concat(function (body) {\n                    var src = body.toString('utf8');\n                    var deps = getDeps(file, src);\n                    if (deps) {\n                        cb(null, {\n                            source: src,\n                            package: pkg,\n                            deps: deps.reduce(function (deps, dep) {\n                                deps[dep] = true;\n                                return deps;\n                            }, {})\n                        });\n                    }\n                }));\n        }\n    });\n\n    function getDeps (file, src) {\n        return rec.noparse ? [] : self.parseDeps(file, src);\n    }\n\n    function fromSource (file, src, pkg, fakePath) {\n        var deps = getDeps(file, src);\n        if (deps) fromDeps(file, src, pkg, fakePath, deps);\n    }\n    \n    function fromDeps (file, src, pkg, fakePath, deps) {\n        var p = deps.length;\n        var resolved = {};\n        \n        if (input) --self.inputPending;\n        \n        (function resolve () {\n            if (self.inputPending > 0) return setTimeout(resolve);\n            deps.forEach(function (id) {\n                if (opts.filter && !opts.filter(id)) {\n                    resolved[id] = false;\n                    if (--p === 0) done();\n                    return;\n                }\n                var isTopLevel = self._isTopLevel(fakePath || file);\n                var current = {\n                    id: file,\n                    filename: file,\n                    paths: self.paths,\n                    package: pkg,\n                    inNodeModules: parent.inNodeModules || !isTopLevel\n                };\n                self.walk(id, current, function (err, r) {\n                    resolved[id] = r;\n                    if (--p === 0) done();\n                });\n            });\n            if (deps.length === 0) done();\n        })();\n        \n        function done () {\n            if (!rec.id) rec.id = file;\n            if (!rec.source) rec.source = src;\n            if (!rec.deps) rec.deps = resolved;\n            if (!rec.file) rec.file = file;\n            \n            if (self.entries.indexOf(file) >= 0) {\n                rec.entry = true;\n            }\n            self.push(rec);\n            \n            if (cb) cb(null, file);\n            if (-- self.pending === 0) self.push(null);\n        }\n    }\n};\n\nDeps.prototype.parseDeps = function (file, src, cb) {\n    if (this.options.noParse === true) return [];\n    if (/\\.json$/.test(file)) return [];\n    \n    if (Array.isArray(this.options.noParse)\n    && this.options.noParse.indexOf(file) >= 0) {\n        return [];\n    }\n    \n    try { var deps = detective(src) }\n    catch (ex) {\n        var message = ex && ex.message ? ex.message : ex;\n        this.emit('error', new Error(\n            'Parsing file ' + file + ': ' + message\n        ));\n        return;\n    }\n    return deps;\n};\n\nDeps.prototype.lookupPackage = function (file, cb) {\n    var self = this;\n    \n    var cached = this.pkgCache[file];\n    if (cached) return nextTick(cb, null, cached);\n    if (cached === false) return nextTick(cb, null, undefined);\n    \n    var dirs = parents(file ? path.dirname(file) : self.basedir);\n    \n    (function next () {\n        if (dirs.length === 0) {\n            self.pkgCache[file] = false;\n            return cb(null, undefined);\n        }\n        var dir = dirs.shift();\n        if (dir.split(/[\\\\\\/]/).slice(-1)[0] === 'node_modules') {\n            return cb(null, undefined);\n        }\n        \n        var pkgfile = path.join(dir, 'package.json');\n        \n        var cached = self.pkgCache[pkgfile];\n        if (cached) return nextTick(cb, null, cached);\n        else if (cached === false) return next();\n        \n        var pcached = self.pkgFileCachePending[pkgfile];\n        if (pcached) return pcached.push(onpkg);\n        pcached = self.pkgFileCachePending[pkgfile] = [];\n        \n        fs.readFile(pkgfile, function (err, src) {\n            if (err) return onpkg();\n            try { var pkg = JSON.parse(src) }\n            catch (err) {\n                return onpkg(new Error([\n                    err + ' while parsing json file ' + pkgfile\n                ].join('')))\n            }\n            pkg.__dirname = dir;\n            \n            self.pkgCache[pkgfile] = pkg;\n            self.pkgCache[file] = pkg;\n            onpkg(null, pkg);\n        });\n        \n        function onpkg (err, pkg) {\n            if (self.pkgFileCachePending[pkgfile]) {\n                var fns = self.pkgFileCachePending[pkgfile];\n                delete self.pkgFileCachePending[pkgfile];\n                fns.forEach(function (f) { f(err, pkg) });\n            }\n            if (err) cb(err)\n            else if (pkg) cb(null, pkg)\n            else {\n                self.pkgCache[pkgfile] = false;\n                next();\n            }\n        }\n    })();\n};\n \nfunction getTransforms (pkg, opts) {\n    var trx = [];\n    if (opts.transformKey) {\n        var n = pkg;\n        var keys = opts.transformKey;\n        for (var i = 0; i < keys.length; i++) {\n            if (n && typeof n === 'object') n = n[keys[i]];\n            else break;\n        }\n        if (i === keys.length) {\n            trx = [].concat(n).filter(Boolean);\n        }\n    }\n    return trx.concat(opts.globalTransform || []);\n}\n\nfunction nextTick (cb) {\n    var args = [].slice.call(arguments, 1);\n    process.nextTick(function () { cb.apply(null, args) });\n}\n\nfunction xhas (obj) {\n    if (!obj) return false;\n    for (var i = 1; i < arguments.length; i++) {\n        var key = arguments[i];\n        if (!has(obj, key)) return false;\n        obj = obj[key];\n    }\n    return true;\n}\n\nfunction toStream (dataAsString) {\n    var tr = through();\n    tr.push(dataAsString);\n    tr.push(null);\n    return tr;\n}\n\nfunction has (obj, key) {\n    return obj && Object.prototype.hasOwnProperty.call(obj, key);\n}\n\nfunction wrapTransform (tr) {\n    if (typeof tr.read === 'function') return tr;\n    var input = through(), output = through();\n    input.pipe(tr).pipe(output);\n    var wrapper = duplexer(input, output);\n    tr.on('error', function (err) { wrapper.emit('error', err) });\n    return wrapper;\n}\n"]},"metadata":{},"sourceType":"script"}