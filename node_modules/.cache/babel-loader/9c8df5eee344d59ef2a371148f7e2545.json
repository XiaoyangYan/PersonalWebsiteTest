{"ast":null,"code":"var core = require('./core');\n\nvar fs = require('fs');\n\nvar path = require('path');\n\nvar caller = require('./caller.js');\n\nvar nodeModulesPaths = require('./node-modules-paths.js');\n\nvar splitRe = process.platform === 'win32' ? /[\\/\\\\]/ : /\\//;\n\nmodule.exports = function resolve(x, opts, cb) {\n  if (typeof opts === 'function') {\n    cb = opts;\n    opts = {};\n  }\n\n  if (!opts) opts = {};\n\n  if (typeof x !== 'string') {\n    return process.nextTick(function () {\n      cb(new Error('path must be a string'));\n    });\n  }\n\n  var isFile = opts.isFile || function (file, cb) {\n    fs.stat(file, function (err, stat) {\n      if (err && err.code === 'ENOENT') cb(null, false);else if (err) cb(err);else cb(null, stat.isFile() || stat.isFIFO());\n    });\n  };\n\n  var readFile = opts.readFile || fs.readFile;\n  var extensions = opts.extensions || ['.js'];\n  var y = opts.basedir || path.dirname(caller());\n  opts.paths = opts.paths || [];\n\n  if (/^(?:\\.\\.?(?:\\/|$)|\\/|([A-Za-z]:)?[\\\\\\/])/.test(x)) {\n    var res = path.resolve(y, x);\n    if (x === '..') res += '/';\n\n    if (/\\/$/.test(x) && res === y) {\n      loadAsDirectory(res, opts.package, onfile);\n    } else loadAsFile(res, opts.package, onfile);\n  } else loadNodeModules(x, y, function (err, n, pkg) {\n    if (err) cb(err);else if (n) cb(null, n, pkg);else if (core[x]) return cb(null, x);else cb(new Error(\"Cannot find module '\" + x + \"' from '\" + y + \"'\"));\n  });\n\n  function onfile(err, m, pkg) {\n    if (err) cb(err);else if (m) cb(null, m, pkg);else loadAsDirectory(res, function (err, d, pkg) {\n      if (err) cb(err);else if (d) cb(null, d, pkg);else cb(new Error(\"Cannot find module '\" + x + \"' from '\" + y + \"'\"));\n    });\n  }\n\n  function loadAsFile(x, pkg, cb) {\n    if (typeof pkg === 'function') {\n      cb = pkg;\n      pkg = undefined;\n    }\n\n    var exts = [''].concat(extensions);\n    load(exts, x, pkg);\n\n    function load(exts, x, pkg) {\n      if (exts.length === 0) return cb(null, undefined, pkg);\n      var file = x + exts[0];\n      if (pkg) onpkg(null, pkg);else loadpkg(path.dirname(file), onpkg);\n\n      function onpkg(err, pkg_, dir) {\n        pkg = pkg_;\n        if (err) return cb(err);\n\n        if (dir && pkg && opts.pathFilter) {\n          var rfile = path.relative(dir, file);\n          var rel = rfile.slice(0, rfile.length - exts[0].length);\n          var r = opts.pathFilter(pkg, x, rel);\n          if (r) return load([''].concat(extensions.slice()), path.resolve(dir, r), pkg);\n        }\n\n        isFile(file, onex);\n      }\n\n      function onex(err, ex) {\n        if (err) cb(err);else if (!ex) load(exts.slice(1), x, pkg);else cb(null, file, pkg);\n      }\n    }\n  }\n\n  function loadpkg(dir, cb) {\n    if (dir === '' || dir === '/') return cb(null);\n\n    if (process.platform === 'win32' && /^\\w:[\\\\\\/]*$/.test(dir)) {\n      return cb(null);\n    }\n\n    if (/[\\\\\\/]node_modules[\\\\\\/]*$/.test(dir)) return cb(null);\n    var pkgfile = path.join(dir, 'package.json');\n    isFile(pkgfile, function (err, ex) {\n      // on err, ex is false\n      if (!ex) return loadpkg(path.dirname(dir), cb);\n      readFile(pkgfile, function (err, body) {\n        if (err) cb(err);\n\n        try {\n          var pkg = JSON.parse(body);\n        } catch (err) {}\n\n        if (pkg && opts.packageFilter) {\n          pkg = opts.packageFilter(pkg, pkgfile);\n        }\n\n        cb(null, pkg, dir);\n      });\n    });\n  }\n\n  function loadAsDirectory(x, fpkg, cb) {\n    if (typeof fpkg === 'function') {\n      cb = fpkg;\n      fpkg = opts.package;\n    }\n\n    var pkgfile = path.join(x, '/package.json');\n    isFile(pkgfile, function (err, ex) {\n      if (err) return cb(err);\n      if (!ex) return loadAsFile(path.join(x, '/index'), fpkg, cb);\n      readFile(pkgfile, function (err, body) {\n        if (err) return cb(err);\n\n        try {\n          var pkg = JSON.parse(body);\n        } catch (err) {}\n\n        if (opts.packageFilter) {\n          pkg = opts.packageFilter(pkg, pkgfile);\n        }\n\n        if (pkg.main) {\n          if (pkg.main === '.' || pkg.main === './') {\n            pkg.main = 'index';\n          }\n\n          loadAsFile(path.resolve(x, pkg.main), pkg, function (err, m, pkg) {\n            if (err) return cb(err);\n            if (m) return cb(null, m, pkg);\n            if (!pkg) return loadAsFile(path.join(x, '/index'), pkg, cb);\n            var dir = path.resolve(x, pkg.main);\n            loadAsDirectory(dir, pkg, function (err, n, pkg) {\n              if (err) return cb(err);\n              if (n) return cb(null, n, pkg);\n              loadAsFile(path.join(x, '/index'), pkg, cb);\n            });\n          });\n          return;\n        }\n\n        loadAsFile(path.join(x, '/index'), pkg, cb);\n      });\n    });\n  }\n\n  function loadNodeModules(x, start, cb) {\n    (function process(dirs) {\n      if (dirs.length === 0) return cb(null, undefined);\n      var dir = dirs[0];\n      var file = path.join(dir, '/', x);\n      loadAsFile(file, undefined, onfile);\n\n      function onfile(err, m, pkg) {\n        if (err) return cb(err);\n        if (m) return cb(null, m, pkg);\n        loadAsDirectory(path.join(dir, '/', x), undefined, ondir);\n      }\n\n      function ondir(err, n, pkg) {\n        if (err) return cb(err);\n        if (n) return cb(null, n, pkg);\n        process(dirs.slice(1));\n      }\n    })(nodeModulesPaths(start, opts));\n  }\n};","map":{"version":3,"sources":["/home/yanxiaoyang/react-project/PersonalWebsiteTest/node_modules/browser-resolve/node_modules/resolve/lib/async.js"],"names":["core","require","fs","path","caller","nodeModulesPaths","splitRe","process","platform","module","exports","resolve","x","opts","cb","nextTick","Error","isFile","file","stat","err","code","isFIFO","readFile","extensions","y","basedir","dirname","paths","test","res","loadAsDirectory","package","onfile","loadAsFile","loadNodeModules","n","pkg","m","d","undefined","exts","concat","load","length","onpkg","loadpkg","pkg_","dir","pathFilter","rfile","relative","rel","slice","r","onex","ex","pkgfile","join","body","JSON","parse","packageFilter","fpkg","main","start","dirs","ondir"],"mappings":"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","sourcesContent":["var core = require('./core');\nvar fs = require('fs');\nvar path = require('path');\nvar caller = require('./caller.js');\nvar nodeModulesPaths = require('./node-modules-paths.js');\nvar splitRe = process.platform === 'win32' ? /[\\/\\\\]/ : /\\//;\n\nmodule.exports = function resolve (x, opts, cb) {\n    if (typeof opts === 'function') {\n        cb = opts;\n        opts = {};\n    }\n    if (!opts) opts = {};\n    if (typeof x !== 'string') {\n        return process.nextTick(function () {\n            cb(new Error('path must be a string'));\n        });\n    }\n    \n    var isFile = opts.isFile || function (file, cb) {\n        fs.stat(file, function (err, stat) {\n            if (err && err.code === 'ENOENT') cb(null, false)\n            else if (err) cb(err)\n            else cb(null, stat.isFile() || stat.isFIFO())\n        });\n    };\n    var readFile = opts.readFile || fs.readFile;\n    \n    var extensions = opts.extensions || [ '.js' ];\n    var y = opts.basedir || path.dirname(caller());\n    \n    opts.paths = opts.paths || [];\n    \n    if (/^(?:\\.\\.?(?:\\/|$)|\\/|([A-Za-z]:)?[\\\\\\/])/.test(x)) {\n        var res = path.resolve(y, x);\n        if (x === '..') res += '/';\n        if (/\\/$/.test(x) && res === y) {\n            loadAsDirectory(res, opts.package, onfile);\n        }\n        else loadAsFile(res, opts.package, onfile);\n    }\n    else loadNodeModules(x, y, function (err, n, pkg) {\n        if (err) cb(err)\n        else if (n) cb(null, n, pkg)\n        else if (core[x]) return cb(null, x);\n        else cb(new Error(\"Cannot find module '\" + x + \"' from '\" + y + \"'\"))\n    });\n    \n    function onfile (err, m, pkg) {\n        if (err) cb(err)\n        else if (m) cb(null, m, pkg)\n        else loadAsDirectory(res, function (err, d, pkg) {\n            if (err) cb(err)\n            else if (d) cb(null, d, pkg)\n            else cb(new Error(\"Cannot find module '\" + x + \"' from '\" + y + \"'\"))\n        })\n    }\n    \n    function loadAsFile (x, pkg, cb) {\n        if (typeof pkg === 'function') {\n            cb = pkg;\n            pkg = undefined;\n        }\n        \n        var exts = [''].concat(extensions);\n        load(exts, x, pkg)\n\t\t\n\t\tfunction load (exts, x, pkg) {\n            if (exts.length === 0) return cb(null, undefined, pkg);\n            var file = x + exts[0];\n            \n            if (pkg) onpkg(null, pkg)\n            else loadpkg(path.dirname(file), onpkg);\n            \n            function onpkg (err, pkg_, dir) {\n                pkg = pkg_;\n                if (err) return cb(err)\n                if (dir && pkg && opts.pathFilter) {\n                    var rfile = path.relative(dir, file);\n                    var rel = rfile.slice(0, rfile.length - exts[0].length);\n                    var r = opts.pathFilter(pkg, x, rel);\n                    if (r) return load(\n                        [''].concat(extensions.slice()),\n                        path.resolve(dir, r),\n                        pkg\n                    );\n                }\n                isFile(file, onex);\n            }\n            function onex (err, ex) {\n                if (err) cb(err)\n                else if (!ex) load(exts.slice(1), x, pkg)\n                else cb(null, file, pkg)\n            }\n        }\n    }\n    \n    function loadpkg (dir, cb) {\n        if (dir === '' || dir === '/') return cb(null);\n        if (process.platform === 'win32' && /^\\w:[\\\\\\/]*$/.test(dir)) {\n            return cb(null);\n        }\n        if (/[\\\\\\/]node_modules[\\\\\\/]*$/.test(dir)) return cb(null);\n        \n        var pkgfile = path.join(dir, 'package.json');\n        isFile(pkgfile, function (err, ex) {\n            // on err, ex is false\n            if (!ex) return loadpkg(\n                path.dirname(dir), cb\n            );\n            \n            readFile(pkgfile, function (err, body) {\n                if (err) cb(err);\n                try { var pkg = JSON.parse(body) }\n                catch (err) {}\n                \n                if (pkg && opts.packageFilter) {\n                    pkg = opts.packageFilter(pkg, pkgfile);\n                }\n                cb(null, pkg, dir);\n            });\n        });\n    }\n    \n    function loadAsDirectory (x, fpkg, cb) {\n        if (typeof fpkg === 'function') {\n            cb = fpkg;\n            fpkg = opts.package;\n        }\n        \n        var pkgfile = path.join(x, '/package.json');\n        isFile(pkgfile, function (err, ex) {\n            if (err) return cb(err);\n            if (!ex) return loadAsFile(path.join(x, '/index'), fpkg, cb);\n            \n            readFile(pkgfile, function (err, body) {\n                if (err) return cb(err);\n                try {\n                    var pkg = JSON.parse(body);\n                }\n                catch (err) {}\n                \n                if (opts.packageFilter) {\n                    pkg = opts.packageFilter(pkg, pkgfile);\n                }\n                \n                if (pkg.main) {\n                    if (pkg.main === '.' || pkg.main === './'){\n                        pkg.main = 'index'\n                    }\n                    loadAsFile(path.resolve(x, pkg.main), pkg, function (err, m, pkg) {\n                        if (err) return cb(err);\n                        if (m) return cb(null, m, pkg);\n                        if (!pkg) return loadAsFile(path.join(x, '/index'), pkg, cb);\n\n                        var dir = path.resolve(x, pkg.main);\n                        loadAsDirectory(dir, pkg, function (err, n, pkg) {\n                            if (err) return cb(err);\n                            if (n) return cb(null, n, pkg);\n                            loadAsFile(path.join(x, '/index'), pkg, cb);\n                        });\n                    });\n                    return;\n                }\n                \n                loadAsFile(path.join(x, '/index'), pkg, cb);\n            });\n        });\n    }\n    \n    function loadNodeModules (x, start, cb) {\n        (function process (dirs) {\n            if (dirs.length === 0) return cb(null, undefined);\n            var dir = dirs[0];\n            \n            var file = path.join(dir, '/', x);\n            loadAsFile(file, undefined, onfile);\n            \n            function onfile (err, m, pkg) {\n                if (err) return cb(err);\n                if (m) return cb(null, m, pkg);\n                loadAsDirectory(path.join(dir, '/', x), undefined, ondir);\n            }\n            \n            function ondir (err, n, pkg) {\n                if (err) return cb(err);\n                if (n) return cb(null, n, pkg);\n                process(dirs.slice(1));\n            }\n        })(nodeModulesPaths(start, opts));\n    }\n};\n"]},"metadata":{},"sourceType":"script"}