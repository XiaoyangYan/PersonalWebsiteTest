{"ast":null,"code":"var utils = require(\"./utils\"),\n    newError = utils.newError,\n    getJsonwireError = utils.getJsonwireError,\n    isWebDriverException = utils.isWebDriverException;\n\nvar cbStub = function () {}; // just calls the callback when there is no result\n\n\nexports.simpleCallback = function (cb) {\n  cb = cb || cbStub;\n  return function (err, data) {\n    if (err) {\n      return cb(err);\n    }\n\n    if (data === '' || data === 'OK') {\n      // expected behaviour when not returning JsonWire response\n      cb(null);\n    } else {\n      // looking for JsonWire response\n      var jsonWireRes;\n      var jsonwireError;\n      var errorMessage;\n      var error;\n\n      try {\n        jsonWireRes = JSON.parse(data);\n      } catch (ign) {}\n\n      if (jsonWireRes && typeof jsonWireRes.status !== \"undefined\") {\n        // valid JsonWire response\n        if (jsonWireRes.status === 0) {\n          cb(null);\n        } else {\n          jsonwireError = getJsonwireError(jsonWireRes.status);\n          errorMessage = 'Error response status: ' + jsonWireRes.status;\n\n          if (jsonwireError) {\n            errorMessage += \", \" + jsonwireError.summary + \" - \" + jsonwireError.detail;\n          }\n\n          if (jsonWireRes.value && jsonWireRes.value.message) {\n            errorMessage += \" Selenium error: \" + jsonWireRes.value.message;\n          }\n\n          error = newError({\n            message: errorMessage,\n            status: jsonWireRes.status,\n            cause: jsonWireRes\n          });\n\n          if (jsonwireError) {\n            error['jsonwire-error'] = jsonwireError;\n          }\n\n          cb(error);\n        }\n      } else if (jsonWireRes && typeof jsonWireRes.value !== \"undefined\") {\n        // valid W3C draft spec response\n        if (jsonWireRes.value === null || Object.keys(jsonWireRes.value).length === 0) {\n          cb(null);\n        } else {\n          jsonwireError = jsonWireRes.value;\n          errorMessage = 'Error response: ' + jsonwireError.error + ' - ' + jsonwireError.message;\n\n          if (jsonwireError.stacktrace) {\n            errorMessage += ' - Stack trace:\\n' + jsonwireError.stacktrace;\n          }\n\n          error = newError({\n            message: errorMessage,\n            cause: jsonwireError\n          });\n          cb(error);\n        }\n      } else {\n        // something wrong\n        cb(newError({\n          message: 'Unexpected data in simpleCallback.',\n          data: jsonWireRes || data\n        }));\n      }\n    }\n  };\n}; // base for all callback handling data\n\n\nvar callbackWithDataBase = function (cb) {\n  cb = cb || cbStub;\n  return function (err, data) {\n    if (err) {\n      return cb(err);\n    }\n\n    var obj, alertText;\n\n    try {\n      obj = JSON.parse(data);\n    } catch (e) {\n      return cb(newError({\n        message: 'Not JSON response',\n        data: data\n      }));\n    }\n\n    try {\n      alertText = obj.value.alert.text;\n    } catch (e) {\n      alertText = '';\n    }\n\n    if (obj.status > 0) {\n      var jsonwireError = getJsonwireError(obj.status);\n      var errorMessage = 'Error response status: ' + obj.status + \", \" + alertText;\n\n      if (jsonwireError) {\n        errorMessage += \", \" + jsonwireError.summary + \" - \" + jsonwireError.detail;\n      }\n\n      if (obj.value && obj.value.message) {\n        errorMessage += \" Selenium error: \" + obj.value.message;\n      }\n\n      var error = newError({\n        message: errorMessage,\n        status: obj.status,\n        cause: obj\n      });\n\n      if (jsonwireError) {\n        error['jsonwire-error'] = jsonwireError;\n      }\n\n      cb(error);\n    } else {\n      cb(null, obj);\n    }\n  };\n}; // retrieves field value from result\n\n\nexports.callbackWithData = function (cb, browser) {\n  cb = cb || cbStub;\n  return callbackWithDataBase(function (err, obj) {\n    if (err) {\n      return cb(err);\n    }\n\n    if (isWebDriverException(obj.value)) {\n      return cb(newError({\n        message: obj.value.message,\n        cause: obj.value\n      }));\n    } // we might get a WebElement back as part of executeScript, so let's\n    // check to make sure we convert if necessary to element objects\n\n\n    var elId = utils.getElementId(obj.value);\n\n    if (obj.value && typeof elId !== \"undefined\") {\n      obj.value = browser.newElement(elId);\n    } else if (Object.prototype.toString.call(obj.value) === \"[object Array]\") {\n      for (var i = 0; i < obj.value.length; i++) {\n        elId = utils.getElementId(obj.value[i]);\n\n        if (obj.value[i] && typeof elId !== \"undefined\") {\n          obj.value[i] = browser.newElement(elId);\n        }\n      }\n    }\n\n    cb(null, obj.value);\n  });\n}; // retrieves ONE element\n\n\nexports.elementCallback = function (cb, browser) {\n  cb = cb || cbStub;\n  return callbackWithDataBase(function (err, obj) {\n    if (err) {\n      return cb(err);\n    }\n\n    if (isWebDriverException(obj.value)) {\n      return cb(newError({\n        message: obj.value.message,\n        cause: obj.value\n      }));\n    }\n\n    var elId = utils.getElementId(obj.value);\n\n    if (!elId) {\n      cb(newError({\n        message: \"no ELEMENT in response value field.\",\n        cause: obj\n      }));\n    } else {\n      var el = browser.newElement(elId);\n      cb(null, el);\n    }\n  });\n}; // retrieves SEVERAL elements\n\n\nexports.elementsCallback = function (cb, browser) {\n  cb = cb || cbStub;\n  return callbackWithDataBase(function (err, obj) {\n    if (err) {\n      return cb(err);\n    }\n\n    if (isWebDriverException(obj.value)) {\n      return cb(newError({\n        message: obj.value.message,\n        cause: obj.value\n      }));\n    }\n\n    if (!Array.isArray(obj.value)) {\n      return cb(newError({\n        message: \"Response value field is not an Array.\",\n        cause: obj.value\n      }));\n    }\n\n    var i,\n        elements = [];\n\n    for (i = 0; i < obj.value.length; i++) {\n      var value = obj.value[i];\n      var elId = utils.getElementId(value);\n      var el = browser.newElement(elId);\n      elements.push(el);\n    }\n\n    cb(null, elements);\n  });\n}; // retrieves ONE or SEVERAL elements\n\n\nexports.elementOrElementsCallback = function (cb, browser) {\n  cb = cb || cbStub;\n  return callbackWithDataBase(function (err, obj) {\n    if (err) {\n      return cb(err);\n    }\n\n    if (isWebDriverException(obj.value)) {\n      return cb(newError({\n        message: obj.value.message,\n        cause: obj.value\n      }));\n    }\n\n    var el;\n    var elId = utils.getElementId(obj.value);\n\n    if (elId) {\n      el = browser.newElement(elId);\n      cb(null, el);\n    } else if (Array.isArray(obj.value)) {\n      var i,\n          elements = [];\n\n      for (i = 0; i < obj.value.length; i++) {\n        elId = utils.getElementId(obj.value[i]);\n        el = browser.newElement(elId);\n        elements.push(el);\n      }\n\n      cb(null, elements);\n    } else {\n      cb(newError({\n        message: \"no element or element array in response value field.\",\n        cause: obj\n      }));\n    }\n  });\n};","map":{"version":3,"sources":["/home/yanxiaoyang/react-project/PersonalWebsiteTest/node_modules/wd/lib/callbacks.js"],"names":["utils","require","newError","getJsonwireError","isWebDriverException","cbStub","exports","simpleCallback","cb","err","data","jsonWireRes","jsonwireError","errorMessage","error","JSON","parse","ign","status","summary","detail","value","message","cause","Object","keys","length","stacktrace","callbackWithDataBase","obj","alertText","e","alert","text","callbackWithData","browser","elId","getElementId","newElement","prototype","toString","call","i","elementCallback","el","elementsCallback","Array","isArray","elements","push","elementOrElementsCallback"],"mappings":"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","sourcesContent":["var utils = require(\"./utils\"),\n    newError = utils.newError,\n    getJsonwireError = utils.getJsonwireError,\n    isWebDriverException = utils.isWebDriverException;\n\nvar cbStub = function() {};\n\n// just calls the callback when there is no result\nexports.simpleCallback = function(cb) {\n  cb = cb || cbStub;\n  return function(err, data) {\n    if(err) { return cb(err); }\n    if((data === '') || (data === 'OK')) {\n      // expected behaviour when not returning JsonWire response\n      cb(null);\n    } else {\n      // looking for JsonWire response\n      var jsonWireRes;\n      var jsonwireError;\n      var errorMessage;\n      var error;\n      try{jsonWireRes = JSON.parse(data);}catch(ign){}\n      if (jsonWireRes && typeof jsonWireRes.status !== \"undefined\") {\n        // valid JsonWire response\n        if(jsonWireRes.status === 0) {\n          cb(null);\n        } else {\n          jsonwireError  = getJsonwireError(jsonWireRes.status);\n          errorMessage = 'Error response status: ' + jsonWireRes.status;\n          if(jsonwireError) {\n            errorMessage += \", \" + jsonwireError.summary + \" - \" + jsonwireError.detail;\n          }\n          if(jsonWireRes.value && jsonWireRes.value.message) {\n            errorMessage += \" Selenium error: \" + jsonWireRes.value.message;\n          }\n          error = newError(\n            { message: errorMessage\n              , status:jsonWireRes.status\n              , cause:jsonWireRes });\n          if(jsonwireError){ error['jsonwire-error'] = jsonwireError; }\n          cb(error);\n        }\n      } else if (jsonWireRes && typeof jsonWireRes.value !== \"undefined\") {\n        // valid W3C draft spec response\n        if (jsonWireRes.value === null || Object.keys(jsonWireRes.value).length === 0) {\n          cb(null);\n        } else {\n          jsonwireError = jsonWireRes.value;\n          errorMessage = 'Error response: ' + jsonwireError.error + ' - ' +\n                             jsonwireError.message;\n          if (jsonwireError.stacktrace) {\n            errorMessage += ' - Stack trace:\\n' + jsonwireError.stacktrace;\n          }\n          error = newError(\n            { message: errorMessage\n              , cause: jsonwireError });\n          cb(error);\n        }\n      } else {\n        // something wrong\n        cb(newError(\n          {message:'Unexpected data in simpleCallback.', data: jsonWireRes || data}) );\n      }\n    }\n  };\n};\n\n// base for all callback handling data\nvar callbackWithDataBase = function(cb) {\n  cb = cb || cbStub;\n  return function(err, data) {\n    if(err) { return cb(err); }\n    var obj,\n        alertText;\n    try {\n      obj = JSON.parse(data);\n    } catch (e) {\n      return cb(newError({message:'Not JSON response', data:data}));\n    }\n    try {\n        alertText = obj.value.alert.text;\n    } catch (e) {\n        alertText = '';\n    }\n    if (obj.status > 0) {\n      var jsonwireError  = getJsonwireError(obj.status);\n      var errorMessage = 'Error response status: ' + obj.status + \", \" +alertText;\n      if(jsonwireError) {\n        errorMessage += \", \" + jsonwireError.summary + \" - \" + jsonwireError.detail;\n      }\n      if(obj.value && obj.value.message) {\n        errorMessage += \" Selenium error: \" + obj.value.message;\n      }\n      var error = newError(\n        { message: errorMessage\n          , status:obj.status\n          , cause:obj });\n      if(jsonwireError){ error['jsonwire-error'] = jsonwireError; }\n      cb(error);\n    } else {\n      cb(null, obj);\n    }\n  };\n};\n\n// retrieves field value from result\nexports.callbackWithData = function(cb, browser) {\n  cb = cb || cbStub;\n  return callbackWithDataBase(function(err,obj) {\n    if(err) {return cb(err);}\n    if(isWebDriverException(obj.value)) {return cb(newError(\n      {message:obj.value.message,cause:obj.value}));}\n    // we might get a WebElement back as part of executeScript, so let's\n    // check to make sure we convert if necessary to element objects\n    var elId = utils.getElementId(obj.value);\n    if(obj.value && typeof elId !== \"undefined\") {\n        obj.value = browser.newElement(elId);\n    } else if (Object.prototype.toString.call(obj.value) === \"[object Array]\") {\n        for (var i = 0; i < obj.value.length; i++) {\n            elId = utils.getElementId(obj.value[i]);\n            if (obj.value[i] && typeof elId !== \"undefined\") {\n                obj.value[i] = browser.newElement(elId);\n            }\n        }\n    }\n    cb(null, obj.value);\n  });\n};\n\n// retrieves ONE element\nexports.elementCallback = function(cb, browser) {\n  cb = cb || cbStub;\n  return callbackWithDataBase(function(err, obj) {\n    if(err) {return cb(err);}\n    if(isWebDriverException(obj.value)) {return cb(newError(\n      {message:obj.value.message,cause:obj.value}));}\n    var elId = utils.getElementId(obj.value);\n    if (!elId) {\n      cb(newError(\n        {message:\"no ELEMENT in response value field.\",cause:obj}));\n    } else {\n      var el = browser.newElement(elId);\n      cb(null, el);\n    }\n  });\n};\n\n// retrieves SEVERAL elements\nexports.elementsCallback = function(cb, browser) {\n  cb = cb || cbStub;\n  return callbackWithDataBase(function(err, obj) {\n    if(err) {return cb(err);}\n    if(isWebDriverException(obj.value)) {return cb(newError(\n      {message:obj.value.message,cause:obj.value}));}\n    if (!Array.isArray(obj.value)) {return cb(newError(\n      {message:\"Response value field is not an Array.\", cause:obj.value}));}\n    var i, elements = [];\n    for (i = 0; i < obj.value.length; i++) {\n      var value = obj.value[i];\n      var elId = utils.getElementId(value);\n      var el = browser.newElement(elId);\n      elements.push(el);\n    }\n    cb(null, elements);\n  });\n};\n\n// retrieves ONE or SEVERAL elements\nexports.elementOrElementsCallback = function(cb, browser) {\n  cb = cb || cbStub;\n  return callbackWithDataBase(function(err, obj) {\n    if(err) {return cb(err);}\n    if(isWebDriverException(obj.value)) {return cb(newError(\n      {message:obj.value.message,cause:obj.value}));}\n    var el;\n    var elId = utils.getElementId(obj.value);\n    if (elId){\n      el = browser.newElement(elId);\n      cb(null, el);\n    } else if (Array.isArray(obj.value)){\n      var i, elements = [];\n      for (i = 0; i < obj.value.length; i++) {\n        elId = utils.getElementId(obj.value[i]);\n        el = browser.newElement(elId);\n        elements.push(el);\n      }\n      cb(null, elements);\n    } else {\n      cb(newError(\n        {message:\"no element or element array in response value field.\",cause:obj}));\n    }\n  });\n};\n"]},"metadata":{},"sourceType":"script"}