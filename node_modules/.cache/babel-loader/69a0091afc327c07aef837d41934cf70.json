{"ast":null,"code":"/**\r\n * TAR Format Plugin\r\n *\r\n * @module plugins/tar\r\n * @license [MIT]{@link https://github.com/archiverjs/node-archiver/blob/master/LICENSE}\r\n * @copyright (c) 2012-2014 Chris Talkington, contributors.\r\n */\nvar zlib = require('zlib');\n\nvar engine = require('tar-stream');\n\nvar util = require('archiver-utils');\n/**\r\n * @constructor\r\n * @param {TarOptions} options\r\n */\n\n\nvar Tar = function (options) {\n  if (!(this instanceof Tar)) {\n    return new Tar(options);\n  }\n\n  options = this.options = util.defaults(options, {\n    gzip: false\n  });\n\n  if (typeof options.gzipOptions !== 'object') {\n    options.gzipOptions = {};\n  }\n\n  this.supports = {\n    directory: true,\n    symlink: true\n  };\n  this.engine = engine.pack(options);\n  this.compressor = false;\n\n  if (options.gzip) {\n    this.compressor = zlib.createGzip(options.gzipOptions);\n    this.compressor.on('error', this._onCompressorError.bind(this));\n  }\n};\n/**\r\n * [_onCompressorError description]\r\n *\r\n * @private\r\n * @param  {Error} err\r\n * @return void\r\n */\n\n\nTar.prototype._onCompressorError = function (err) {\n  this.engine.emit('error', err);\n};\n/**\r\n * [append description]\r\n *\r\n * @param  {(Buffer|Stream)} source\r\n * @param  {TarEntryData} data\r\n * @param  {Function} callback\r\n * @return void\r\n */\n\n\nTar.prototype.append = function (source, data, callback) {\n  var self = this;\n  data.mtime = data.date;\n\n  function append(err, sourceBuffer) {\n    if (err) {\n      callback(err);\n      return;\n    }\n\n    self.engine.entry(data, sourceBuffer, function (err) {\n      callback(err, data);\n    });\n  }\n\n  if (data.sourceType === 'buffer') {\n    append(null, source);\n  } else if (data.sourceType === 'stream' && data.stats) {\n    data.size = data.stats.size;\n    var entry = self.engine.entry(data, function (err) {\n      callback(err, data);\n    });\n    source.pipe(entry);\n  } else if (data.sourceType === 'stream') {\n    util.collectStream(source, append);\n  }\n};\n/**\r\n * [finalize description]\r\n *\r\n * @return void\r\n */\n\n\nTar.prototype.finalize = function () {\n  this.engine.finalize();\n};\n/**\r\n * [on description]\r\n *\r\n * @return this.engine\r\n */\n\n\nTar.prototype.on = function () {\n  return this.engine.on.apply(this.engine, arguments);\n};\n/**\r\n * [pipe description]\r\n *\r\n * @param  {String} destination\r\n * @param  {Object} options\r\n * @return this.engine\r\n */\n\n\nTar.prototype.pipe = function (destination, options) {\n  if (this.compressor) {\n    return this.engine.pipe.apply(this.engine, [this.compressor]).pipe(destination, options);\n  } else {\n    return this.engine.pipe.apply(this.engine, arguments);\n  }\n};\n/**\r\n * [unpipe description]\r\n *\r\n * @return this.engine\r\n */\n\n\nTar.prototype.unpipe = function () {\n  if (this.compressor) {\n    return this.compressor.unpipe.apply(this.compressor, arguments);\n  } else {\n    return this.engine.unpipe.apply(this.engine, arguments);\n  }\n};\n\nmodule.exports = Tar;\n/**\r\n * @typedef {Object} TarOptions\r\n * @global\r\n * @property {Boolean} [gzip=false] Compress the tar archive using gzip.\r\n * @property {Object} [gzipOptions] Passed to [zlib]{@link https://nodejs.org/api/zlib.html#zlib_class_options}\r\n * to control compression.\r\n * @property {*} [*] See [tar-stream]{@link https://github.com/mafintosh/tar-stream} documentation for additional properties.\r\n */\n\n/**\r\n * @typedef {Object} TarEntryData\r\n * @global\r\n * @property {String} name Sets the entry name including internal path.\r\n * @property {(String|Date)} [date=NOW()] Sets the entry date.\r\n * @property {Number} [mode=D:0755/F:0644] Sets the entry permissions.\r\n * @property {String} [prefix] Sets a path prefix for the entry name. Useful\r\n * when working with methods like `directory` or `glob`.\r\n * @property {fs.Stats} [stats] Sets the fs stat data for this entry allowing\r\n * for reduction of fs stat calls when stat data is already known.\r\n */\n\n/**\r\n * TarStream Module\r\n * @external TarStream\r\n * @see {@link https://github.com/mafintosh/tar-stream}\r\n */","map":{"version":3,"sources":["/home/yanxiaoyang/react-project/PersonalWebsiteTest/node_modules/archiver/lib/plugins/tar.js"],"names":["zlib","require","engine","util","Tar","options","defaults","gzip","gzipOptions","supports","directory","symlink","pack","compressor","createGzip","on","_onCompressorError","bind","prototype","err","emit","append","source","data","callback","self","mtime","date","sourceBuffer","entry","sourceType","stats","size","pipe","collectStream","finalize","apply","arguments","destination","unpipe","module","exports"],"mappings":"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","sourcesContent":["/**\r\n * TAR Format Plugin\r\n *\r\n * @module plugins/tar\r\n * @license [MIT]{@link https://github.com/archiverjs/node-archiver/blob/master/LICENSE}\r\n * @copyright (c) 2012-2014 Chris Talkington, contributors.\r\n */\r\nvar zlib = require('zlib');\r\n\r\nvar engine = require('tar-stream');\r\nvar util = require('archiver-utils');\r\n\r\n/**\r\n * @constructor\r\n * @param {TarOptions} options\r\n */\r\nvar Tar = function(options) {\r\n  if (!(this instanceof Tar)) {\r\n    return new Tar(options);\r\n  }\r\n\r\n  options = this.options = util.defaults(options, {\r\n    gzip: false\r\n  });\r\n\r\n  if (typeof options.gzipOptions !== 'object') {\r\n    options.gzipOptions = {};\r\n  }\r\n\r\n  this.supports = {\r\n    directory: true,\r\n    symlink: true\r\n  };\r\n\r\n  this.engine = engine.pack(options);\r\n  this.compressor = false;\r\n\r\n  if (options.gzip) {\r\n    this.compressor = zlib.createGzip(options.gzipOptions);\r\n    this.compressor.on('error', this._onCompressorError.bind(this));\r\n  }\r\n};\r\n\r\n/**\r\n * [_onCompressorError description]\r\n *\r\n * @private\r\n * @param  {Error} err\r\n * @return void\r\n */\r\nTar.prototype._onCompressorError = function(err) {\r\n  this.engine.emit('error', err);\r\n};\r\n\r\n/**\r\n * [append description]\r\n *\r\n * @param  {(Buffer|Stream)} source\r\n * @param  {TarEntryData} data\r\n * @param  {Function} callback\r\n * @return void\r\n */\r\nTar.prototype.append = function(source, data, callback) {\r\n  var self = this;\r\n\r\n  data.mtime = data.date;\r\n\r\n  function append(err, sourceBuffer) {\r\n    if (err) {\r\n      callback(err);\r\n      return;\r\n    }\r\n\r\n    self.engine.entry(data, sourceBuffer, function(err) {\r\n      callback(err, data);\r\n    });\r\n  }\r\n\r\n  if (data.sourceType === 'buffer') {\r\n    append(null, source);\r\n  } else if (data.sourceType === 'stream' && data.stats) {\r\n    data.size = data.stats.size;\r\n\r\n    var entry = self.engine.entry(data, function(err) {\r\n      callback(err, data);\r\n    });\r\n\r\n    source.pipe(entry);\r\n  } else if (data.sourceType === 'stream') {\r\n    util.collectStream(source, append);\r\n  }\r\n};\r\n\r\n/**\r\n * [finalize description]\r\n *\r\n * @return void\r\n */\r\nTar.prototype.finalize = function() {\r\n  this.engine.finalize();\r\n};\r\n\r\n/**\r\n * [on description]\r\n *\r\n * @return this.engine\r\n */\r\nTar.prototype.on = function() {\r\n  return this.engine.on.apply(this.engine, arguments);\r\n};\r\n\r\n/**\r\n * [pipe description]\r\n *\r\n * @param  {String} destination\r\n * @param  {Object} options\r\n * @return this.engine\r\n */\r\nTar.prototype.pipe = function(destination, options) {\r\n  if (this.compressor) {\r\n    return this.engine.pipe.apply(this.engine, [this.compressor]).pipe(destination, options);\r\n  } else {\r\n    return this.engine.pipe.apply(this.engine, arguments);\r\n  }\r\n};\r\n\r\n/**\r\n * [unpipe description]\r\n *\r\n * @return this.engine\r\n */\r\nTar.prototype.unpipe = function() {\r\n  if (this.compressor) {\r\n    return this.compressor.unpipe.apply(this.compressor, arguments);\r\n  } else {\r\n    return this.engine.unpipe.apply(this.engine, arguments);\r\n  }\r\n};\r\n\r\nmodule.exports = Tar;\r\n\r\n/**\r\n * @typedef {Object} TarOptions\r\n * @global\r\n * @property {Boolean} [gzip=false] Compress the tar archive using gzip.\r\n * @property {Object} [gzipOptions] Passed to [zlib]{@link https://nodejs.org/api/zlib.html#zlib_class_options}\r\n * to control compression.\r\n * @property {*} [*] See [tar-stream]{@link https://github.com/mafintosh/tar-stream} documentation for additional properties.\r\n */\r\n\r\n/**\r\n * @typedef {Object} TarEntryData\r\n * @global\r\n * @property {String} name Sets the entry name including internal path.\r\n * @property {(String|Date)} [date=NOW()] Sets the entry date.\r\n * @property {Number} [mode=D:0755/F:0644] Sets the entry permissions.\r\n * @property {String} [prefix] Sets a path prefix for the entry name. Useful\r\n * when working with methods like `directory` or `glob`.\r\n * @property {fs.Stats} [stats] Sets the fs stat data for this entry allowing\r\n * for reduction of fs stat calls when stat data is already known.\r\n */\r\n\r\n/**\r\n * TarStream Module\r\n * @external TarStream\r\n * @see {@link https://github.com/mafintosh/tar-stream}\r\n */\r\n"]},"metadata":{},"sourceType":"script"}